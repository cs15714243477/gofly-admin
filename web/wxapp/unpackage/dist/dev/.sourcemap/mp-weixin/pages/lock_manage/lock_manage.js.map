{"version":3,"file":"lock_manage.js","sources":["pages/lock_manage/lock_manage.vue","D:/WinApp/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9ja19tYW5hZ2UvbG9ja19tYW5hZ2UudnVl"],"sourcesContent":["<template>\n  <view class=\"lm\">\n    <TopHeader title=\"智能门锁\">\n      <template #left>\n        <view class=\"icon-btn\" @tap=\"goBack\">\n          <text class=\"material-symbols-outlined\">arrow_back</text>\n        </view>\n      </template>\n    </TopHeader>\n\n    <view class=\"toolbar\">\n      <view class=\"search-box\">\n        <text class=\"material-symbols-outlined search-ic\">search</text>\n        <input\n          v-model=\"keyword\"\n          class=\"search-input\"\n          type=\"text\"\n          confirm-type=\"search\"\n          placeholder=\"搜索锁名 / ID / MAC...\"\n          placeholder-class=\"placeholder\"\n          @confirm=\"handleSearch\"\n        />\n        <view v-if=\"keyword\" class=\"clear-btn\" @tap=\"clearKeyword\">\n          <text class=\"material-symbols-outlined\">close</text>\n        </view>\n      </view>\n\n      <view class=\"status-row\">\n        <view class=\"chip\" :class=\"{ ok: status.config_ok }\">\n          <text class=\"material-symbols-outlined chip-ic\">settings</text>\n          <text class=\"chip-txt\">{{ status.config_ok ? \"配置正常\" : \"未配置\" }}</text>\n        </view>\n        <view class=\"chip\" :class=\"{ ok: status.has_token }\">\n          <text class=\"material-symbols-outlined chip-ic\">key</text>\n          <text class=\"chip-txt\">{{ status.has_token ? \"Token有效\" : \"Token缺失\" }}</text>\n        </view>\n        <view class=\"chip ghost\" v-if=\"status.api_base\">\n          <text class=\"material-symbols-outlined chip-ic\">link</text>\n          <text class=\"chip-txt\">{{ status.api_base }}</text>\n        </view>\n      </view>\n    </view>\n\n    <scroll-view\n      scroll-y=\"true\"\n      class=\"list\"\n      :refresher-enabled=\"true\"\n      :refresher-triggered=\"refreshing\"\n      lower-threshold=\"160\"\n      @refresherrefresh=\"onRefresh\"\n      @scrolltolower=\"loadMore\"\n    >\n      <view class=\"list-content\">\n        <view v-if=\"filteredLocks.length === 0 && !loading\" class=\"empty\">\n          <text class=\"material-symbols-outlined empty-ic\">smart_lock</text>\n          <text class=\"empty-title\">暂无设备数据</text>\n          <text class=\"empty-sub\">请先点击右下角“同步”或稍后再试</text>\n        </view>\n\n        <view\n          class=\"card\"\n          v-for=\"it in filteredLocks\"\n          :key=\"it.ttlock_lock_id\"\n        >\n          <view class=\"card-head\">\n            <view class=\"head-left\">\n              <view class=\"lock-ic\">\n                <text class=\"material-symbols-outlined\">smart_lock</text>\n              </view>\n              <view class=\"head-texts\">\n                <text class=\"lock-name\">{{ it.lock_name || \"未命名锁\" }}</text>\n                <text class=\"lock-sub\"\n                  >ID: {{ it.ttlock_lock_id }} · {{ it.lock_mac || \"-\" }}</text\n                >\n              </view>\n            </view>\n            <view class=\"battery\" :class=\"batteryClass(it.battery)\">\n              <text class=\"material-symbols-outlined bat-ic\">battery_full</text>\n              <text class=\"bat-txt\">{{ normalizeBattery(it.battery) }}%</text>\n            </view>\n          </view>\n\n          <view class=\"bind-box\">\n            <view v-if=\"it.bind_property_id\" class=\"bind-on\">\n              <text class=\"bind-tag on\">已绑定</text>\n              <view class=\"bind-info\">\n                <text class=\"bind-title\"\n                  >{{ it.bind_property_title || \"房源\" }}（{{ it.bind_property_id }}）</text\n                >\n                <text class=\"bind-sub\">{{\n                  it.bind_property_community_name || \"-\"\n                }}</text>\n              </view>\n              <view class=\"unbind-btn\" @tap.stop=\"confirmUnbind(it)\">\n                <text class=\"material-symbols-outlined\">link_off</text>\n              </view>\n            </view>\n            <view v-else class=\"bind-off\">\n              <text class=\"bind-tag off\">未绑定</text>\n              <text class=\"bind-tip\">点击“绑定房源”完成绑定</text>\n            </view>\n          </view>\n\n          <view class=\"card-actions\">\n            <button class=\"btn ghost\" @tap.stop=\"openBind(it)\">\n              <text class=\"material-symbols-outlined btn-ic\">link</text>\n              <text>{{ it.bind_property_id ? \"更换绑定\" : \"绑定房源\" }}</text>\n            </button>\n          </view>\n        </view>\n\n        <view v-if=\"loading\" class=\"loading-row\">\n          <text class=\"material-symbols-outlined spin\">progress_activity</text>\n          <text>加载中...</text>\n        </view>\n        <view v-else-if=\"finished && list.length > 0\" class=\"end-row\">\n          <text>没有更多了</text>\n        </view>\n      </view>\n\n      <view class=\"bottom-spacer\"></view>\n    </scroll-view>\n\n    <!-- 右下角悬浮操作 -->\n    <view class=\"fab\">\n      <view class=\"fab-btn ghost\" :class=\"{ disabled: loading }\" @tap=\"onRefresh\">\n        <text class=\"material-symbols-outlined fab-ic\">refresh</text>\n        <text class=\"fab-txt\">刷新</text>\n      </view>\n      <view class=\"fab-btn primary\" :class=\"{ disabled: syncing }\" @tap=\"handleSync\">\n        <text class=\"material-symbols-outlined fab-ic\">sync</text>\n        <text class=\"fab-txt\">同步</text>\n      </view>\n    </view>\n\n    <!-- 绑定房源弹窗 -->\n    <view class=\"mask\" v-if=\"bindVisible\" @tap=\"closeBind\">\n      <view class=\"sheet\" @tap.stop>\n        <view class=\"sheet-head\">\n          <text class=\"sheet-title\">绑定房源</text>\n          <view class=\"sheet-close\" @tap=\"closeBind\">\n            <text class=\"material-symbols-outlined\">close</text>\n          </view>\n        </view>\n        <view class=\"sheet-sub\">{{ bindLockDisplay }}</view>\n\n        <view class=\"p-search\">\n          <text class=\"material-symbols-outlined p-ic\">search</text>\n          <input\n            v-model=\"propertyKeyword\"\n            class=\"p-input\"\n            type=\"text\"\n            confirm-type=\"search\"\n            placeholder=\"搜索房源标题/小区...\"\n            placeholder-class=\"placeholder\"\n            @confirm=\"searchProperties(true)\"\n          />\n          <view v-if=\"propertyKeyword\" class=\"p-clear\" @tap=\"clearPropertyKeyword\">\n            <text class=\"material-symbols-outlined\">close</text>\n          </view>\n        </view>\n\n        <scroll-view\n          scroll-y=\"true\"\n          class=\"p-list\"\n          lower-threshold=\"160\"\n          @scrolltolower=\"loadMoreProperties\"\n        >\n          <view v-if=\"propertyLoading && propertyList.length === 0\" class=\"p-loading\">\n            <text>加载中...</text>\n          </view>\n\n          <view v-else-if=\"!propertyLoading && propertyList.length === 0\" class=\"p-empty\">\n            <text>暂无房源</text>\n          </view>\n\n          <view\n            class=\"p-item\"\n            v-for=\"p in propertyList\"\n            :key=\"p.id\"\n            @tap=\"selectProperty(p)\"\n          >\n            <view class=\"p-main\">\n              <text class=\"p-title\">{{ p.title || \"-\" }}</text>\n              <text class=\"p-sub\"\n                >{{ p.community_name || \"-\" }} · {{ p.sale_status_label || \"-\" }}</text\n              >\n            </view>\n            <text class=\"material-symbols-outlined p-arrow\">chevron_right</text>\n          </view>\n\n          <view v-if=\"propertyFinished && propertyList.length > 0\" class=\"p-end\">\n            <text>没有更多了</text>\n          </view>\n          <view style=\"height: 20rpx\"></view>\n        </scroll-view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nimport TopHeader from \"@/components/TopHeader.vue\";\nimport ttlockApi from \"@/api/ttlock\";\nimport propertyApi from \"@/api/property\";\nimport $store from \"@/store\";\n\nexport default {\n  components: { TopHeader },\n  data() {\n    return {\n      permissionChecked: false,\n      loading: false,\n      refreshing: false,\n      finished: false,\n      syncing: false,\n      page: 1,\n      pageSize: 20,\n      total: 0,\n      list: [],\n      keyword: \"\",\n      status: {\n        config_ok: false,\n        has_token: false,\n        api_base: \"\",\n        expire_at: 0,\n      },\n\n      // bind modal\n      bindVisible: false,\n      bindLock: null,\n      propertyKeyword: \"\",\n      propertyLoading: false,\n      propertyFinished: false,\n      propertyPage: 1,\n      propertyPageSize: 15,\n      propertyList: [],\n    };\n  },\n  computed: {\n    filteredLocks() {\n      const kw = String(this.keyword || \"\").trim().toLowerCase();\n      const items = Array.isArray(this.list) ? this.list : [];\n      if (!kw) return items;\n      return items.filter((it) => {\n        const name = String(it && it.lock_name).toLowerCase();\n        const mac = String(it && it.lock_mac).toLowerCase();\n        const id = String(it && it.ttlock_lock_id);\n        return name.includes(kw) || mac.includes(kw) || id.includes(kw);\n      });\n    },\n    bindLockDisplay() {\n      const l = this.bindLock || {};\n      const name = l.lock_name || \"未命名锁\";\n      const mac = l.lock_mac ? ` · ${l.lock_mac}` : \"\";\n      return `${name}（${l.ttlock_lock_id || \"-\"}）${mac}`;\n    },\n  },\n  onShow() {\n    this.ensurePermissionAndBootstrap();\n  },\n  methods: {\n    goBack() {\n      uni.navigateBack();\n    },\n    async ensurePermissionAndBootstrap() {\n      const userStore = $store(\"user\");\n      const token = uni.getStorageSync(\"token\");\n      if (token && !userStore.isLogin) userStore.setToken(token);\n      if (!token && !userStore.isLogin) {\n        uni.reLaunch({ url: \"/pages/login/login\" });\n        return;\n      }\n\n      if (!this.permissionChecked) {\n        try {\n          const info = await userStore.getInfo();\n          const u = info || userStore.userInfo || {};\n          if (Number(u.can_manage_locks) !== 1) {\n            uni.showModal({\n              title: \"提示\",\n              content: \"暂无智能门锁管理权限，请联系后台管理员开启。\",\n              showCancel: false,\n              success: () => uni.navigateBack(),\n            });\n            return;\n          }\n          this.permissionChecked = true;\n        } catch (e) {\n          uni.showToast({ title: \"获取权限失败，请重试\", icon: \"none\" });\n          return;\n        }\n      }\n\n      if (!this.status || typeof this.status.config_ok === \"undefined\") {\n        await this.fetchStatus();\n      } else if (!this.status.api_base) {\n        await this.fetchStatus();\n      }\n\n      if (!Array.isArray(this.list) || this.list.length === 0) {\n        await this.fetchList(true);\n      }\n    },\n    async fetchStatus() {\n      try {\n        const res = await ttlockApi.getStatus();\n        if (!res || res.code !== 0) return;\n        this.status = res.data || {};\n      } catch (e) {}\n    },\n    handleSearch() {\n      // 前端过滤即可，不额外请求\n    },\n    clearKeyword() {\n      this.keyword = \"\";\n    },\n    normalizeBattery(v) {\n      const n = Number(v);\n      if (!isFinite(n) || n < 0) return 0;\n      if (n > 100) return 100;\n      return Math.round(n);\n    },\n    batteryClass(v) {\n      const n = this.normalizeBattery(v);\n      if (n <= 20) return \"low\";\n      if (n <= 50) return \"mid\";\n      return \"high\";\n    },\n    async onRefresh() {\n      if (this.refreshing || this.loading) return;\n      this.refreshing = true;\n      await this.fetchStatus();\n      await this.fetchList(true);\n      this.refreshing = false;\n    },\n    async loadMore() {\n      if (this.loading || this.finished) return;\n      this.page += 1;\n      await this.fetchList(false);\n    },\n    async fetchList(reset) {\n      if (this.loading) return false;\n      this.loading = true;\n      try {\n        if (reset) {\n          this.page = 1;\n          this.finished = false;\n          this.list = [];\n          this.total = 0;\n        }\n        const res = await ttlockApi.getLockList({\n          page: this.page,\n          pageSize: this.pageSize,\n        });\n        if (!res || res.code !== 0) return false;\n        const data = res.data || {};\n        const items = Array.isArray(data.items) ? data.items : [];\n        const total = Number(data.total || 0);\n        this.total = total;\n        this.list = (Array.isArray(this.list) ? this.list : []).concat(items);\n        if (this.list.length >= total || items.length === 0) this.finished = true;\n        return true;\n      } catch (e) {\n        if (!uni.getStorageSync(\"token\")) {\n          uni.reLaunch({ url: \"/pages/login/login\" });\n        }\n        return false;\n      } finally {\n        this.loading = false;\n      }\n    },\n    async handleSync() {\n      if (this.syncing) return;\n      this.syncing = true;\n      try {\n        const res = await ttlockApi.syncLocks();\n        if (res && res.code === 0) {\n          uni.showToast({ title: \"同步完成\", icon: \"success\" });\n          await this.onRefresh();\n        }\n      } catch (e) {\n      } finally {\n        this.syncing = false;\n      }\n    },\n\n    // ---- bind property ----\n    openBind(lock) {\n      if (!lock || !lock.ttlock_lock_id) return;\n      this.bindLock = lock;\n      this.bindVisible = true;\n      this.propertyKeyword = \"\";\n      this.propertyPage = 1;\n      this.propertyFinished = false;\n      this.propertyList = [];\n      this.searchProperties(true);\n    },\n    closeBind() {\n      this.bindVisible = false;\n      this.bindLock = null;\n    },\n    clearPropertyKeyword() {\n      this.propertyKeyword = \"\";\n      this.searchProperties(true);\n    },\n    async searchProperties(reset) {\n      if (this.propertyLoading) return;\n      this.propertyLoading = true;\n      try {\n        if (reset) {\n          this.propertyPage = 1;\n          this.propertyFinished = false;\n          this.propertyList = [];\n        }\n        const res = await propertyApi.getList({\n          page: this.propertyPage,\n          pageSize: this.propertyPageSize,\n          keyword: String(this.propertyKeyword || \"\").trim(),\n          category: \"all\",\n        });\n        if (!res || res.code !== 0) return;\n        const data = res.data || {};\n        const items = Array.isArray(data.items) ? data.items : [];\n        const total = Number(data.total || 0);\n        const merged = (Array.isArray(this.propertyList) ? this.propertyList : []).concat(items);\n        this.propertyList = merged;\n        if (merged.length >= total || items.length === 0) this.propertyFinished = true;\n      } catch (e) {\n      } finally {\n        this.propertyLoading = false;\n      }\n    },\n    async loadMoreProperties() {\n      if (this.propertyLoading || this.propertyFinished) return;\n      this.propertyPage += 1;\n      await this.searchProperties(false);\n    },\n    async selectProperty(p) {\n      const pid = Number(p && p.id) || 0;\n      const lockId = Number(this.bindLock && this.bindLock.ttlock_lock_id) || 0;\n      if (!pid || !lockId) return;\n      try {\n        const res = await ttlockApi.bindProperty({ property_id: pid, ttlock_lock_id: lockId });\n        if (!res || res.code !== 0) return;\n        uni.showToast({ title: \"绑定成功\", icon: \"success\" });\n        this.closeBind();\n        await this.fetchList(true);\n      } catch (e) {}\n    },\n    confirmUnbind(lock) {\n      const pid = Number(lock && lock.bind_property_id) || 0;\n      if (!pid) return;\n      uni.showModal({\n        title: \"解绑\",\n        content: \"确认解绑该房源与智能锁？\",\n        success: async (r) => {\n          if (!r.confirm) return;\n          try {\n            const res = await ttlockApi.unbindProperty({ property_id: pid });\n            if (!res || res.code !== 0) return;\n            uni.showToast({ title: \"解绑成功\", icon: \"success\" });\n            await this.fetchList(true);\n          } catch (e) {}\n        },\n      });\n    },\n  },\n};\n</script>\n\n<style>\n.lm {\n  height: 100vh;\n  background-color: #f6f7f8;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n\n.right-actions {\n  display: flex;\n  align-items: center;\n  gap: 12rpx;\n}\n\n.fab {\n  position: fixed;\n  right: 24rpx;\n  bottom: calc(env(safe-area-inset-bottom) + 28rpx);\n  display: flex;\n  flex-direction: column;\n  gap: 14rpx;\n  z-index: 80;\n}\n\n.fab-btn {\n  min-width: 156rpx;\n  height: 84rpx;\n  padding: 0 18rpx;\n  border-radius: 999rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 10rpx;\n  border: 1px solid rgba(226, 232, 240, 0.9);\n  background: rgba(255, 255, 255, 0.92);\n  color: #0f172a;\n  box-shadow: 0 12rpx 24rpx rgba(15, 23, 42, 0.12);\n}\n\n.fab-btn.primary {\n  background: linear-gradient(135deg, #2d9cf0, #2563eb);\n  border: none;\n  color: #ffffff;\n  box-shadow: 0 16rpx 30rpx rgba(37, 99, 235, 0.26);\n}\n\n.fab-btn.disabled {\n  opacity: 0.55;\n  pointer-events: none;\n}\n\n.fab-ic {\n  font-size: 34rpx;\n  line-height: 1;\n  display: block;\n}\n\n.fab-txt {\n  font-size: 26rpx;\n  font-weight: 800;\n  letter-spacing: 0.6rpx;\n}\n\n.icon-btn {\n  width: 72rpx;\n  height: 72rpx;\n  border-radius: 40rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border: 1px solid rgba(226, 232, 240, 0.9);\n  background: rgba(255, 255, 255, 0.9);\n  color: #0f172a;\n}\n\n.icon-btn.primary {\n  background: linear-gradient(135deg, #2d9cf0, #2563eb);\n  border: none;\n  color: #ffffff;\n  box-shadow: 0 12rpx 26rpx rgba(37, 99, 235, 0.2);\n}\n\n.icon-btn.ghost {\n  background: rgba(255, 255, 255, 0.9);\n  color: #0f172a;\n}\n\n.icon-btn.disabled {\n  opacity: 0.55;\n}\n\n.toolbar {\n  padding: 14rpx 24rpx 10rpx;\n}\n\n.search-box {\n  background: #ffffff;\n  border: 1px solid #e2e8f0;\n  border-radius: 22rpx;\n  padding: 0 16rpx;\n  height: 76rpx;\n  display: flex;\n  align-items: center;\n  gap: 12rpx;\n  box-shadow: 0 10rpx 18rpx rgba(15, 23, 42, 0.03);\n}\n\n.search-ic {\n  font-size: 34rpx;\n  color: #94a3b8;\n}\n\n.search-input {\n  flex: 1;\n  height: 76rpx;\n  font-size: 26rpx;\n  color: #0f172a;\n}\n\n.placeholder {\n  color: #94a3b8;\n}\n\n.clear-btn {\n  width: 56rpx;\n  height: 56rpx;\n  border-radius: 999rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #64748b;\n}\n\n.status-row {\n  margin-top: 12rpx;\n  display: flex;\n  align-items: center;\n  gap: 12rpx;\n  flex-wrap: wrap;\n}\n\n.chip {\n  display: flex;\n  align-items: center;\n  gap: 8rpx;\n  padding: 10rpx 14rpx;\n  border-radius: 999rpx;\n  font-size: 22rpx;\n  font-weight: 700;\n  color: #64748b;\n  background: rgba(148, 163, 184, 0.14);\n  border: 1px solid rgba(148, 163, 184, 0.18);\n}\n\n.chip.ok {\n  color: #2563eb;\n  background: rgba(37, 99, 235, 0.12);\n  border: 1px solid rgba(37, 99, 235, 0.18);\n}\n\n.chip.ghost {\n  color: #475569;\n  background: rgba(255, 255, 255, 0.85);\n  border: 1px solid rgba(226, 232, 240, 0.9);\n}\n\n.chip-ic {\n  font-size: 26rpx;\n}\n\n.chip-txt {\n  max-width: 420rpx;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n}\n\n.list {\n  flex: 1;\n  overflow: hidden;\n}\n\n.list-content {\n  padding: 0 24rpx 18rpx;\n}\n\n.empty {\n  padding: 80rpx 0 30rpx;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  color: #64748b;\n}\n\n.empty-ic {\n  font-size: 72rpx;\n  color: #cbd5e1;\n}\n\n.empty-title {\n  margin-top: 14rpx;\n  font-size: 30rpx;\n  font-weight: 800;\n  color: #0f172a;\n}\n\n.empty-sub {\n  margin-top: 8rpx;\n  font-size: 24rpx;\n}\n\n.card {\n  background: #ffffff;\n  border-radius: 28rpx;\n  border: 1px solid #f1f5f9;\n  box-shadow: 0 10rpx 20rpx rgba(15, 23, 42, 0.03);\n  padding: 18rpx;\n  margin-top: 14rpx;\n}\n\n.card-head {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 12rpx;\n}\n\n.head-left {\n  display: flex;\n  align-items: center;\n  gap: 14rpx;\n  min-width: 0;\n}\n\n.lock-ic {\n  width: 64rpx;\n  height: 64rpx;\n  border-radius: 20rpx;\n  background: rgba(37, 99, 235, 0.1);\n  color: #2563eb;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex: 0 0 auto;\n}\n\n.lock-ic .material-symbols-outlined {\n  font-size: 38rpx;\n  line-height: 1;\n  display: block;\n  transform: translateX(-110rpx);\n}\n\n.head-texts {\n  display: flex;\n  flex-direction: column;\n  gap: 6rpx;\n  min-width: 0;\n}\n\n.lock-name {\n  font-size: 30rpx;\n  font-weight: 900;\n  color: #0f172a;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n}\n\n.lock-sub {\n  font-size: 22rpx;\n  color: #64748b;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n}\n\n.battery {\n  display: flex;\n  align-items: center;\n  gap: 8rpx;\n  padding: 10rpx 14rpx;\n  border-radius: 999rpx;\n  font-size: 22rpx;\n  font-weight: 800;\n  color: #2563eb;\n  background: rgba(37, 99, 235, 0.12);\n  border: 1px solid rgba(37, 99, 235, 0.16);\n  flex: 0 0 auto;\n}\n\n.battery.mid {\n  color: #f97316;\n  background: rgba(249, 115, 22, 0.12);\n  border: 1px solid rgba(249, 115, 22, 0.18);\n}\n\n.battery.low {\n  color: #ef4444;\n  background: rgba(239, 68, 68, 0.12);\n  border: 1px solid rgba(239, 68, 68, 0.18);\n}\n\n.battery.high {\n  color: #16a34a;\n  background: rgba(34, 197, 94, 0.12);\n  border: 1px solid rgba(34, 197, 94, 0.18);\n}\n\n.bat-ic {\n  font-size: 24rpx;\n}\n\n.bind-box {\n  margin-top: 14rpx;\n  padding: 14rpx 14rpx;\n  border-radius: 22rpx;\n  background: #f8fafc;\n  border: 1px solid #e2e8f0;\n}\n\n.bind-on {\n  display: flex;\n  gap: 12rpx;\n  align-items: flex-start;\n}\n\n.bind-off {\n  display: flex;\n  gap: 12rpx;\n  align-items: center;\n}\n\n.bind-tag {\n  font-size: 20rpx;\n  font-weight: 900;\n  padding: 6rpx 12rpx;\n  border-radius: 999rpx;\n}\n\n.bind-tag.on {\n  color: #16a34a;\n  background: rgba(34, 197, 94, 0.12);\n  border: 1px solid rgba(34, 197, 94, 0.18);\n}\n\n.bind-tag.off {\n  color: #64748b;\n  background: rgba(148, 163, 184, 0.12);\n  border: 1px solid rgba(148, 163, 184, 0.18);\n}\n\n.bind-info {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 6rpx;\n  min-width: 0;\n}\n\n.unbind-btn {\n  width: 56rpx;\n  height: 56rpx;\n  border-radius: 18rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #ef4444;\n  background: rgba(239, 68, 68, 0.1);\n  border: 1px solid rgba(239, 68, 68, 0.18);\n  flex: 0 0 auto;\n}\n\n.unbind-btn .material-symbols-outlined {\n  font-size: 30rpx;\n}\n\n.bind-title {\n  font-size: 24rpx;\n  font-weight: 800;\n  color: #0f172a;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n}\n\n.bind-sub {\n  font-size: 22rpx;\n  color: #64748b;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n}\n\n.bind-tip {\n  font-size: 22rpx;\n  color: #64748b;\n}\n\n.card-actions {\n  margin-top: 14rpx;\n  display: flex;\n  gap: 12rpx;\n  align-items: center;\n}\n\n.btn {\n  flex: 1;\n  height: 66rpx;\n  border-radius: 18rpx;\n  font-size: 24rpx;\n  font-weight: 800;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8rpx;\n}\n\n.btn::after {\n  border: none;\n}\n\n.btn-ic {\n  font-size: 28rpx;\n}\n\n.btn.ghost {\n  background: #ffffff;\n  border: 1px solid rgba(226, 232, 240, 0.9);\n  color: #0f172a;\n}\n\n.btn.primary {\n  background: linear-gradient(135deg, #2d9cf0, #2563eb);\n  color: #ffffff;\n  box-shadow: 0 12rpx 26rpx rgba(37, 99, 235, 0.2);\n}\n\n.loading-row,\n.end-row {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 10rpx;\n  padding: 18rpx 0 10rpx;\n  color: #64748b;\n  font-size: 24rpx;\n}\n\n.spin {\n  font-size: 30rpx;\n  color: #2563eb;\n}\n\n.bottom-spacer {\n  height: calc(env(safe-area-inset-bottom) + 240rpx);\n}\n\n/* ---------- modal ---------- */\n.mask {\n  position: fixed;\n  inset: 0;\n  background: rgba(15, 23, 42, 0.42);\n  display: flex;\n  align-items: flex-end;\n  justify-content: center;\n  z-index: 999;\n}\n\n.sheet {\n  width: 100%;\n  max-height: 78vh;\n  background: #ffffff;\n  border-top-left-radius: 28rpx;\n  border-top-right-radius: 28rpx;\n  overflow: hidden;\n  box-shadow: 0 -18rpx 40rpx rgba(15, 23, 42, 0.18);\n  display: flex;\n  flex-direction: column;\n}\n\n.sheet-head {\n  padding: 18rpx 18rpx 12rpx;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  border-bottom: 1px solid rgba(226, 232, 240, 0.9);\n}\n\n.sheet-title {\n  font-size: 30rpx;\n  font-weight: 900;\n  color: #0f172a;\n}\n\n.sheet-close {\n  width: 64rpx;\n  height: 64rpx;\n  border-radius: 18rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #64748b;\n  background: rgba(148, 163, 184, 0.12);\n}\n\n.sheet-sub {\n  padding: 10rpx 18rpx 0;\n  font-size: 22rpx;\n  color: #64748b;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n}\n\n.p-search {\n  margin: 14rpx 18rpx 10rpx;\n  background: #ffffff;\n  border: 1px solid #e2e8f0;\n  border-radius: 20rpx;\n  height: 72rpx;\n  padding: 0 14rpx;\n  display: flex;\n  align-items: center;\n  gap: 10rpx;\n}\n\n.p-ic {\n  font-size: 30rpx;\n  color: #94a3b8;\n}\n\n.p-input {\n  flex: 1;\n  height: 72rpx;\n  font-size: 26rpx;\n  color: #0f172a;\n}\n\n.p-clear {\n  width: 52rpx;\n  height: 52rpx;\n  border-radius: 999rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #64748b;\n}\n\n.p-list {\n  flex: 1;\n  overflow: hidden;\n  padding: 0 18rpx 0;\n}\n\n.p-item {\n  padding: 16rpx 12rpx;\n  border-radius: 20rpx;\n  border: 1px solid rgba(226, 232, 240, 0.9);\n  background: #ffffff;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 10rpx;\n  margin-bottom: 12rpx;\n}\n\n.p-main {\n  display: flex;\n  flex-direction: column;\n  gap: 6rpx;\n  flex: 1;\n  min-width: 0;\n}\n\n.p-title {\n  font-size: 26rpx;\n  font-weight: 900;\n  color: #0f172a;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n}\n\n.p-sub {\n  font-size: 22rpx;\n  color: #64748b;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n}\n\n.p-arrow {\n  font-size: 34rpx;\n  color: #cbd5e1;\n}\n\n.p-loading,\n.p-empty,\n.p-end {\n  padding: 22rpx 0 12rpx;\n  text-align: center;\n  color: #64748b;\n  font-size: 24rpx;\n}\n\n</style>\n","import MiniProgramPage from 'E:/Work/Progect/GoFly-admin/main-admin/web/wxapp/pages/lock_manage/lock_manage.vue'\nwx.createPage(MiniProgramPage)"],"names":["_sfc_main","components","TopHeader","data","permissionChecked","loading","refreshing","finished","syncing","page","pageSize","total","list","keyword","status","config_ok","has_token","api_base","expire_at","bindVisible","bindLock","propertyKeyword","propertyLoading","propertyFinished","propertyPage","propertyPageSize","propertyList","computed","filteredLocks","kw","String","this","trim","toLowerCase","items","Array","isArray","filter","it","name","lock_name","mac","lock_mac","id","ttlock_lock_id","includes","bindLockDisplay","l","onShow","ensurePermissionAndBootstrap","methods","goBack","uni","index$1","navigateBack","userStore","$store","token","getStorageSync","isLogin","setToken","u","getInfo","userInfo","Number","can_manage_locks","showModal","title","content","showCancel","success","e","showToast","icon","fetchStatus","length","fetchList","reLaunch","url","res","ttlockApi","getStatus","code","handleSearch","clearKeyword","normalizeBattery","v","n","isFinite","Math","round","batteryClass","onRefresh","loadMore","reset","getLockList","concat","handleSync","syncLocks","openBind","lock","searchProperties","closeBind","clearPropertyKeyword","propertyApi","getList","category","merged","loadMoreProperties","selectProperty","p","pid","lockId","bindProperty","property_id","confirmUnbind","bind_property_id","async","r","confirm","unbindProperty","wx","createPage","MiniProgramPage"],"mappings":"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"}