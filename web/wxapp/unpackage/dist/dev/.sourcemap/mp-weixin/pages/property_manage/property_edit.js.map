{"version":3,"file":"property_edit.js","sources":["pages/property_manage/property_edit.vue","D:/WinApp/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcHJvcGVydHlfbWFuYWdlL3Byb3BlcnR5X2VkaXQudnVl"],"sourcesContent":["<template>\n  <view class=\"pe\">\n    <TopHeader :title=\"id ? '编辑房源' : '新增房源'\">\n      <template #left>\n        <view class=\"icon-btn\" @tap=\"goBack\">\n          <text class=\"material-symbols-outlined\">arrow_back</text>\n        </view>\n      </template>\n    </TopHeader>\n\n    <scroll-view scroll-y=\"true\" class=\"content\">\n      <!-- 基础信息 -->\n      <view class=\"card\">\n        <view class=\"card-title\">基础信息</view>\n\n        <view class=\"form-row\">\n          <text class=\"label required\">房源标题</text>\n          <input\n            v-model=\"form.title\"\n            class=\"input\"\n            type=\"text\"\n            maxlength=\"100\"\n            placeholder=\"请输入房源标题\"\n            placeholder-class=\"placeholder\"\n          />\n        </view>\n\n        <view class=\"grid\">\n          <view class=\"form-row\">\n            <text class=\"label required\">销售状态</text>\n            <picker\n              mode=\"selector\"\n              :range=\"saleStatusOptions.map((o) => o.label)\"\n              :value=\"saleStatusIndex\"\n              @change=\"onSaleStatusChange\"\n            >\n              <view class=\"picker\">\n                <text class=\"picker-text\">{{\n                  saleStatusOptions[saleStatusIndex]?.label || \"请选择\"\n                }}</text>\n                <text class=\"material-symbols-outlined picker-ic\"\n                  >expand_more</text\n                >\n              </view>\n            </picker>\n          </view>\n\n          <view class=\"form-row\">\n            <text class=\"label\">价格</text>\n            <view class=\"price-row\">\n              <input\n                v-model=\"form.price\"\n                class=\"input\"\n                type=\"digit\"\n                placeholder=\"0\"\n                placeholder-class=\"placeholder\"\n              />\n              <picker\n                mode=\"selector\"\n                :range=\"priceUnitOptions.map((o) => o.label)\"\n                :value=\"priceUnitIndex\"\n                @change=\"onPriceUnitChange\"\n              >\n                <view class=\"unit-picker\">\n                  <text class=\"unit-text\">{{\n                    priceUnitOptions[priceUnitIndex]?.label ||\n                    form.price_unit ||\n                    \"万\"\n                  }}</text>\n                  <text class=\"material-symbols-outlined unit-ic\"\n                    >expand_more</text\n                  >\n                </view>\n              </picker>\n            </view>\n          </view>\n\n          <view class=\"form-row\">\n            <text class=\"label\">面积(㎡)</text>\n            <input\n              v-model=\"form.area\"\n              class=\"input\"\n              type=\"digit\"\n              placeholder=\"0\"\n              placeholder-class=\"placeholder\"\n            />\n          </view>\n\n          <view class=\"form-row\">\n            <text class=\"label\">户型</text>\n            <view class=\"room-row\">\n              <input\n                v-model=\"form.rooms\"\n                class=\"mini\"\n                type=\"number\"\n                placeholder=\"室\"\n                placeholder-class=\"placeholder\"\n              />\n              <text class=\"mini-suffix\">室</text>\n              <input\n                v-model=\"form.halls\"\n                class=\"mini\"\n                type=\"number\"\n                placeholder=\"厅\"\n                placeholder-class=\"placeholder\"\n              />\n              <text class=\"mini-suffix\">厅</text>\n              <input\n                v-model=\"form.bathrooms\"\n                class=\"mini\"\n                type=\"number\"\n                placeholder=\"卫\"\n                placeholder-class=\"placeholder\"\n              />\n              <text class=\"mini-suffix\">卫</text>\n            </view>\n          </view>\n        </view>\n      </view>\n\n      <!-- 房源参数 -->\n      <view class=\"card\">\n        <view class=\"card-title\">房源参数</view>\n\n        <view class=\"grid\">\n          <view class=\"form-row\">\n            <text class=\"label\">建成年份</text>\n            <picker\n              mode=\"selector\"\n              :range=\"buildYearOptions.map((o) => o.label)\"\n              :value=\"buildYearIndex\"\n              @change=\"onBuildYearChange\"\n            >\n              <view class=\"picker\">\n                <text class=\"picker-text\">{{\n                  buildYearOptions[buildYearIndex]?.label || \"请选择\"\n                }}</text>\n                <text class=\"material-symbols-outlined picker-ic\"\n                  >expand_more</text\n                >\n              </view>\n            </picker>\n          </view>\n\n          <view class=\"form-row\">\n            <text class=\"label\">楼层位置</text>\n            <picker\n              mode=\"selector\"\n              :range=\"floorLevelOptions.map((o) => o.label)\"\n              :value=\"floorLevelIndex\"\n              @change=\"onFloorLevelChange\"\n            >\n              <view class=\"picker\">\n                <text class=\"picker-text\">{{\n                  floorLevelOptions[floorLevelIndex]?.label || \"请选择\"\n                }}</text>\n                <text class=\"material-symbols-outlined picker-ic\"\n                  >expand_more</text\n                >\n              </view>\n            </picker>\n          </view>\n\n          <view class=\"form-row\">\n            <text class=\"label\">总楼层</text>\n            <input\n              v-model=\"form.total_floors\"\n              class=\"input\"\n              type=\"number\"\n              placeholder=\"共多少层\"\n              placeholder-class=\"placeholder\"\n            />\n          </view>\n\n          <view class=\"form-row\">\n            <text class=\"label\">朝向</text>\n            <picker\n              mode=\"selector\"\n              :range=\"orientationOptions.map((o) => o.label)\"\n              :value=\"orientationIndex\"\n              @change=\"onOrientationChange\"\n            >\n              <view class=\"picker\">\n                <text class=\"picker-text\">{{\n                  orientationOptions[orientationIndex]?.label || \"请选择\"\n                }}</text>\n                <text class=\"material-symbols-outlined picker-ic\"\n                  >expand_more</text\n                >\n              </view>\n            </picker>\n          </view>\n\n          <view class=\"form-row\">\n            <text class=\"label\">物业类型</text>\n            <picker\n              mode=\"selector\"\n              :range=\"propertyTypeOptions.map((o) => o.label)\"\n              :value=\"propertyTypeIndex\"\n              @change=\"onPropertyTypeChange\"\n            >\n              <view class=\"picker\">\n                <text class=\"picker-text\">{{\n                  propertyTypeOptions[propertyTypeIndex]?.label || \"请选择\"\n                }}</text>\n                <text class=\"material-symbols-outlined picker-ic\"\n                  >expand_more</text\n                >\n              </view>\n            </picker>\n          </view>\n\n          <view class=\"form-row\">\n            <text class=\"label\">装修标准</text>\n            <picker\n              mode=\"selector\"\n              :range=\"decorationTypeOptions.map((o) => o.label)\"\n              :value=\"decorationTypeIndex\"\n              @change=\"onDecorationTypeChange\"\n            >\n              <view class=\"picker\">\n                <text class=\"picker-text\">{{\n                  decorationTypeOptions[decorationTypeIndex]?.label || \"请选择\"\n                }}</text>\n                <text class=\"material-symbols-outlined picker-ic\"\n                  >expand_more</text\n                >\n              </view>\n            </picker>\n          </view>\n        </view>\n      </view>\n\n      <!-- 房主与收房 -->\n      <view class=\"card\">\n        <view class=\"card-title\">房主与收房</view>\n        <view class=\"grid\">\n          <view class=\"form-row\">\n            <text class=\"label\">房主姓名</text>\n            <input\n              v-model=\"form.owner_name\"\n              class=\"input\"\n              type=\"text\"\n              placeholder=\"可选\"\n              placeholder-class=\"placeholder\"\n            />\n          </view>\n\n          <view class=\"form-row\">\n            <text class=\"label\">房主电话</text>\n            <input\n              v-model=\"form.owner_phone\"\n              class=\"input\"\n              type=\"number\"\n              placeholder=\"可选\"\n              placeholder-class=\"placeholder\"\n            />\n          </view>\n\n          <view class=\"form-row\">\n            <text class=\"label\">收房人姓名</text>\n            <input\n              v-model=\"form.receiver_name\"\n              class=\"input\"\n              type=\"text\"\n              placeholder=\"可选\"\n              placeholder-class=\"placeholder\"\n            />\n          </view>\n\n          <view class=\"form-row\">\n            <text class=\"label\">收房人电话</text>\n            <input\n              v-model=\"form.receiver_phone\"\n              class=\"input\"\n              type=\"number\"\n              placeholder=\"可选\"\n              placeholder-class=\"placeholder\"\n            />\n          </view>\n        </view>\n        <view class=\"form-row\">\n          <text class=\"label\">收房价格(支付业主)</text>\n          <input\n            v-model=\"form.receiver_price\"\n            class=\"input\"\n            type=\"digit\"\n            placeholder=\"未填写\"\n            placeholder-class=\"placeholder\"\n          />\n        </view>\n      </view>\n\n      <!-- 图片 -->\n      <view class=\"card\">\n        <view class=\"card-title\">图片</view>\n        <view class=\"hint\">建议上传清晰横图，点击图片可设置封面/删除</view>\n\n        <view class=\"media-grid\">\n          <view\n            v-for=\"(img, idx) in images\"\n            :key=\"'img-' + idx\"\n            class=\"media-item\"\n            @tap=\"openImageActions(idx)\"\n          >\n            <image\n              class=\"media-img\"\n              :src=\"toFullMediaUrl(img)\"\n              mode=\"aspectFill\"\n            ></image>\n            <view v-if=\"img === form.cover_image\" class=\"badge\">封面</view>\n          </view>\n          <view class=\"media-item add\" @tap=\"pickImages\">\n            <text class=\"material-symbols-outlined add-ic\"\n              >add_photo_alternate</text\n            >\n            <text class=\"add-text\">添加</text>\n          </view>\n        </view>\n\n        <view class=\"switch-row\">\n          <view class=\"switch-left\">\n            <text class=\"material-symbols-outlined sw-ic\">download</text>\n            <text class=\"sw-text\">允许下载图片</text>\n          </view>\n          <switch\n            :checked=\"Number(form.allow_image_download) === 1\"\n            @change=\"\n              (e) => (form.allow_image_download = e.detail.value ? 1 : 0)\n            \"\n            color=\"#2563eb\"\n          />\n        </view>\n      </view>\n\n      <!-- 视频 -->\n      <view class=\"card\">\n        <view class=\"card-title\">视频</view>\n        <view class=\"hint\">支持单个房源视频，建议 10-30 秒</view>\n\n        <view class=\"video-box\" @tap=\"openVideoActions\">\n          <view v-if=\"!form.video_url\" class=\"video-empty\">\n            <text class=\"material-symbols-outlined video-ic\">movie</text>\n            <view class=\"video-texts\">\n              <text class=\"video-title\">未上传视频</text>\n              <text class=\"video-sub\">点击上传/更换</text>\n            </view>\n          </view>\n          <video\n            v-else\n            class=\"video\"\n            :src=\"toFullMediaUrl(form.video_url)\"\n            controls\n            object-fit=\"cover\"\n          ></video>\n        </view>\n\n        <view class=\"switch-row\">\n          <view class=\"switch-left\">\n            <text class=\"material-symbols-outlined sw-ic\">download</text>\n            <text class=\"sw-text\">允许下载视频</text>\n          </view>\n          <switch\n            :checked=\"Number(form.allow_video_download) === 1\"\n            @change=\"\n              (e) => (form.allow_video_download = e.detail.value ? 1 : 0)\n            \"\n            color=\"#2563eb\"\n          />\n        </view>\n      </view>\n\n      <!-- 标签 -->\n      <view class=\"card\">\n        <view class=\"card-title\">标签</view>\n        <view class=\"tag-row\">\n          <view class=\"tag\" v-for=\"(t, idx) in tags\" :key=\"'t-' + idx\">\n            <text class=\"tag-text\">{{ t }}</text>\n            <text\n              class=\"material-symbols-outlined tag-x\"\n              @tap.stop=\"removeTag(idx)\"\n              >close</text\n            >\n          </view>\n          <view v-if=\"tags.length === 0\" class=\"hint small\">暂无标签</view>\n        </view>\n        <view class=\"tag-add\">\n          <input\n            v-model=\"newTag\"\n            class=\"input\"\n            type=\"text\"\n            maxlength=\"12\"\n            placeholder=\"输入标签（最多6个）\"\n            placeholder-class=\"placeholder\"\n          />\n          <button class=\"btn add\" @tap=\"addTag\">添加</button>\n        </view>\n      </view>\n\n      <!-- 位置 -->\n      <view class=\"card\">\n        <view class=\"card-title\">位置</view>\n        <view class=\"form-row\">\n          <text class=\"label\">小区名称</text>\n          <input\n            v-model=\"form.community_name\"\n            class=\"input\"\n            type=\"text\"\n            placeholder=\"请输入小区/楼盘\"\n            placeholder-class=\"placeholder\"\n          />\n        </view>\n\n        <view class=\"form-row\">\n          <text class=\"label\">省市区</text>\n          <picker\n            mode=\"region\"\n            :value=\"addressRegion\"\n            @change=\"onAddressRegionChange\"\n          >\n            <view class=\"picker\">\n              <text class=\"picker-text\">{{ addressRegionText }}</text>\n              <text class=\"material-symbols-outlined picker-ic\"\n                >expand_more</text\n              >\n            </view>\n          </picker>\n        </view>\n\n        <view class=\"form-row\">\n          <text class=\"label\">详细地址</text>\n          <input\n            v-model=\"addressDetail\"\n            class=\"input\"\n            type=\"text\"\n            placeholder=\"街道、门牌号、楼栋单元等\"\n            placeholder-class=\"placeholder\"\n          />\n        </view>\n\n        <view class=\"coord-row\">\n          <view class=\"coord-left\">\n            <text class=\"material-symbols-outlined coord-ic\">my_location</text>\n            <text class=\"coord-text\">{{\n              form.latitude && form.longitude\n                ? Number(form.latitude).toFixed(6) +\n                  \", \" +\n                  Number(form.longitude).toFixed(6)\n                : \"未选择坐标\"\n            }}</text>\n          </view>\n          <button class=\"btn ghost\" @tap=\"pickLocation\">地图选点</button>\n        </view>\n      </view>\n\n      <!-- 发布与佣金 -->\n      <view class=\"card\">\n        <view class=\"card-title\">发布与佣金</view>\n        <view class=\"grid\">\n          <view class=\"form-row\">\n            <text class=\"label\">佣金比例(%)</text>\n            <input\n              v-model=\"form.commission_rate\"\n              class=\"input\"\n              type=\"digit\"\n              placeholder=\"0-100\"\n              placeholder-class=\"placeholder\"\n            />\n          </view>\n\n          <view class=\"form-row\">\n            <text class=\"label\">成交奖励金</text>\n            <input\n              v-model=\"form.commission_reward\"\n              class=\"input\"\n              type=\"digit\"\n              placeholder=\"0\"\n              placeholder-class=\"placeholder\"\n            />\n          </view>\n\n          <view class=\"form-row\">\n            <text class=\"label\">排序权重</text>\n            <input\n              v-model=\"form.weigh\"\n              class=\"input\"\n              type=\"number\"\n              placeholder=\"0\"\n              placeholder-class=\"placeholder\"\n            />\n          </view>\n\n          <view class=\"form-row\">\n            <text class=\"label\">智能门锁</text>\n            <view class=\"picker disabled\">\n              <text class=\"picker-text\">{{\n                Number(form.has_smart_lock) === 1 ? \"已绑定\" : \"未绑定\"\n              }}</text>\n              <text class=\"material-symbols-outlined picker-ic\">lock</text>\n            </view>\n            <view class=\"hint small tip\">门锁请在后台/详情页绑定</view>\n          </view>\n        </view>\n\n        <view class=\"switch-row\">\n          <view class=\"switch-left\">\n            <text class=\"material-symbols-outlined sw-ic\">stars</text>\n            <text class=\"sw-text\">推荐房源</text>\n          </view>\n          <switch\n            :checked=\"Number(form.hot_status) === 1\"\n            @change=\"(e) => (form.hot_status = e.detail.value ? 1 : 0)\"\n            color=\"#2563eb\"\n          />\n        </view>\n\n        <view class=\"switch-row\">\n          <view class=\"switch-left\">\n            <text class=\"material-symbols-outlined sw-ic\">visibility</text>\n            <text class=\"sw-text\">房源启用</text>\n          </view>\n          <switch\n            :checked=\"Number(form.status) === 0\"\n            @change=\"(e) => (form.status = e.detail.value ? 0 : 1)\"\n            color=\"#2563eb\"\n          />\n        </view>\n      </view>\n\n      <!-- 装修进度（放在最后） -->\n      <view class=\"card\">\n        <view class=\"card-title\">装修进度</view>\n        <view class=\"hint\">装修信息无需单独保存，点击底部“保存”会一起提交</view>\n\n        <view class=\"form-row\">\n          <text class=\"label\">装修状态</text>\n          <picker\n            mode=\"selector\"\n            :range=\"renovationStatusOptions.map((o) => o.label)\"\n            :value=\"renovationStatusIndex\"\n            @change=\"onRenovationStatusChange\"\n          >\n            <view class=\"picker\">\n              <text class=\"picker-text\">{{\n                renovationStatusOptions[renovationStatusIndex]?.label ||\n                \"请选择\"\n              }}</text>\n              <text class=\"material-symbols-outlined picker-ic\"\n                >expand_more</text\n              >\n            </view>\n          </picker>\n          <view v-if=\"!id\" class=\"hint small tip\"\n            >请先保存房源生成ID后再维护装修进度</view\n          >\n        </view>\n\n        <view v-if=\"id && renovation.renovation_status !== 'none'\" class=\"grid\">\n          <view class=\"form-row\">\n            <text class=\"label\">进度(%)</text>\n            <input\n              v-model=\"renovation.progress_percentage\"\n              class=\"input\"\n              type=\"number\"\n              placeholder=\"0-100\"\n              placeholder-class=\"placeholder\"\n            />\n          </view>\n\n          <view class=\"form-row\">\n            <text class=\"label\">当前阶段</text>\n            <picker\n              mode=\"selector\"\n              :range=\"renovationStageOptions.map((o) => o.label)\"\n              :value=\"renovationStageIndex\"\n              @change=\"onRenovationStageChange\"\n            >\n              <view class=\"picker\">\n                <text class=\"picker-text\">{{\n                  renovationStageOptions[renovationStageIndex]?.label ||\n                  \"请选择\"\n                }}</text>\n                <text class=\"material-symbols-outlined picker-ic\"\n                  >expand_more</text\n                >\n              </view>\n            </picker>\n          </view>\n\n          <view class=\"form-row\">\n            <text class=\"label\">开始日期</text>\n            <picker\n              mode=\"date\"\n              :value=\"renovation.start_date\"\n              @change=\"(e) => (renovation.start_date = e.detail.value)\"\n            >\n              <view class=\"picker\">\n                <text class=\"picker-text\">{{\n                  renovation.start_date || \"请选择\"\n                }}</text>\n                <text class=\"material-symbols-outlined picker-ic\"\n                  >calendar_month</text\n                >\n              </view>\n            </picker>\n          </view>\n\n          <view class=\"form-row\">\n            <text class=\"label\">预计完工</text>\n            <picker\n              mode=\"date\"\n              :value=\"renovation.estimated_finish_date\"\n              @change=\"\n                (e) => (renovation.estimated_finish_date = e.detail.value)\n              \"\n            >\n              <view class=\"picker\">\n                <text class=\"picker-text\">{{\n                  renovation.estimated_finish_date || \"请选择\"\n                }}</text>\n                <text class=\"material-symbols-outlined picker-ic\">event</text>\n              </view>\n            </picker>\n          </view>\n\n          <view class=\"form-row\">\n            <text class=\"label\">实际完工</text>\n            <picker\n              mode=\"date\"\n              :value=\"renovation.actual_finish_date\"\n              @change=\"(e) => (renovation.actual_finish_date = e.detail.value)\"\n            >\n              <view class=\"picker\">\n                <text class=\"picker-text\">{{\n                  renovation.actual_finish_date || \"请选择\"\n                }}</text>\n                <text class=\"material-symbols-outlined picker-ic\"\n                  >verified</text\n                >\n              </view>\n            </picker>\n          </view>\n        </view>\n\n        <view v-if=\"id && renovation.renovation_status !== 'none'\">\n          <view class=\"form-row\">\n            <text class=\"label\">材料</text>\n            <view class=\"tag-row\">\n              <view\n                class=\"tag\"\n                v-for=\"(t, idx) in renovationMaterials\"\n                :key=\"'m-' + idx\"\n              >\n                <text class=\"tag-text\">{{ t }}</text>\n                <text\n                  class=\"material-symbols-outlined tag-x\"\n                  @tap.stop=\"removeMaterial(idx)\"\n                  >close</text\n                >\n              </view>\n              <view v-if=\"renovationMaterials.length === 0\" class=\"hint small\"\n                >暂无材料</view\n              >\n            </view>\n            <view class=\"tag-add\">\n              <input\n                v-model=\"newMaterial\"\n                class=\"input\"\n                type=\"text\"\n                maxlength=\"12\"\n                placeholder=\"输入材料（最多10个）\"\n                placeholder-class=\"placeholder\"\n              />\n              <button class=\"btn add\" @tap=\"addMaterial\">添加</button>\n            </view>\n          </view>\n\n          <view class=\"form-row\">\n            <text class=\"label\">装修图片</text>\n            <view class=\"media-grid\">\n              <view\n                v-for=\"(img, idx) in renovationImages\"\n                :key=\"'rimg-' + idx\"\n                class=\"media-item\"\n                @tap=\"openRenovationImageActions(idx)\"\n              >\n                <image\n                  class=\"media-img\"\n                  :src=\"toFullMediaUrl(img)\"\n                  mode=\"aspectFill\"\n                ></image>\n              </view>\n              <view class=\"media-item add\" @tap=\"pickRenovationImages\">\n                <text class=\"material-symbols-outlined add-ic\"\n                  >add_photo_alternate</text\n                >\n                <text class=\"add-text\">添加</text>\n              </view>\n            </view>\n          </view>\n\n          <view class=\"form-row\">\n            <text class=\"label\">施工说明</text>\n            <textarea\n              v-model=\"renovation.notes\"\n              class=\"textarea\"\n              maxlength=\"500\"\n              placeholder=\"可选：记录进度说明、施工要点等\"\n              placeholder-class=\"placeholder\"\n            ></textarea>\n          </view>\n\n          <view class=\"renovation-actions\">\n            <button\n              class=\"btn ghost\"\n              :disabled=\"savingRenovation || uploading\"\n              @tap=\"loadRenovation\"\n            >\n              刷新\n            </button>\n          </view>\n        </view>\n      </view>\n\n      <view class=\"bottom-spacer\"></view>\n    </scroll-view>\n\n    <!-- 底部操作栏 -->\n    <view class=\"footer\">\n      <button\n        class=\"footer-btn ghost\"\n        :disabled=\"!id || saving || savingRenovation || uploading\"\n        @tap=\"preview\"\n      >\n        预览\n      </button>\n      <button\n        class=\"footer-btn primary\"\n        :disabled=\"saving || savingRenovation || uploading\"\n        @tap=\"save\"\n      >\n        {{ saving || savingRenovation ? \"保存中...\" : \"保存\" }}\n      </button>\n    </view>\n  </view>\n</template>\n\n<script>\nimport TopHeader from \"@/components/TopHeader.vue\";\nimport propertyApi from \"@/api/property\";\nimport $store from \"@/store\";\nimport md5 from \"js-md5\";\nimport { baseUrl } from \"@/utils/config\";\n\n// base64 编码（兼容小程序端无 window.btoa）\nfunction base64Encode(str = \"\") {\n  try {\n    // #ifdef H5\n    return window.btoa(str);\n    // #endif\n  } catch (e) {}\n\n  // #ifndef H5\n  const utf8ToBytes = (s) => {\n    const bytes = [];\n    for (let i = 0; i < s.length; i++) {\n      let codePoint = s.charCodeAt(i);\n      if (codePoint < 0x80) {\n        bytes.push(codePoint);\n      } else if (codePoint < 0x800) {\n        bytes.push(0xc0 | (codePoint >> 6));\n        bytes.push(0x80 | (codePoint & 0x3f));\n      } else {\n        bytes.push(0xe0 | (codePoint >> 12));\n        bytes.push(0x80 | ((codePoint >> 6) & 0x3f));\n        bytes.push(0x80 | (codePoint & 0x3f));\n      }\n    }\n    return new Uint8Array(bytes);\n  };\n  const buf = utf8ToBytes(str).buffer;\n  // eslint-disable-next-line no-undef\n  if (typeof wx !== \"undefined\" && wx.arrayBufferToBase64)\n    return wx.arrayBufferToBase64(buf);\n  if (typeof uni !== \"undefined\" && uni.arrayBufferToBase64)\n    return uni.arrayBufferToBase64(buf);\n  return \"\";\n  // #endif\n}\n\nexport default {\n  components: { TopHeader },\n  data() {\n    const curYear = new Date().getFullYear();\n    const buildYearOptions = [{ label: \"请选择\", value: \"\" }].concat(\n      Array.from({ length: curYear - 1950 + 1 }).map((_, i) => {\n        const y = String(curYear - i);\n        return { label: y, value: y };\n      })\n    );\n\n    return {\n      id: 0,\n      saving: false,\n      uploading: false,\n      form: {\n        title: \"\",\n        price: \"\",\n        price_unit: \"万\",\n        area: \"\",\n        rooms: 0,\n        halls: 0,\n        bathrooms: 0,\n        build_year: \"\",\n        floor_level: \"\",\n        total_floors: \"\",\n        orientation: \"\",\n        property_type: \"\",\n        decoration_type: \"\",\n        community_name: \"\",\n        address: \"\",\n        latitude: \"\",\n        longitude: \"\",\n        tags: [],\n        images: [],\n        cover_image: \"\",\n        video_url: \"\",\n        allow_image_download: 1,\n        allow_video_download: 1,\n        sale_status: \"on_sale\",\n        owner_name: \"\",\n        owner_phone: \"\",\n        receiver_name: \"\",\n        receiver_phone: \"\",\n        receiver_price: \"\",\n        commission_rate: \"\",\n        commission_reward: \"\",\n        weigh: \"\",\n        hot_status: 0,\n        has_smart_lock: 0,\n        status: 0,\n      },\n      tags: [],\n      images: [],\n      newTag: \"\",\n      // 地址分段输入：省市区 + 详细地址（最终保存时合成到 form.address）\n      addressRegion: [\"\", \"\", \"\"],\n      addressDetail: \"\",\n      saleStatusOptions: [\n        { label: \"在售\", value: \"on_sale\" },\n        { label: \"已售\", value: \"sold\" },\n        { label: \"下架\", value: \"off_market\" },\n      ],\n      buildYearOptions,\n      floorLevelOptions: [\n        { label: \"低层 (1-6)\", value: \"低层\" },\n        { label: \"中层 (7-15)\", value: \"中层\" },\n        { label: \"高层 (16+)\", value: \"高层\" },\n        { label: \"地下\", value: \"地下\" },\n      ],\n      orientationOptions: [\n        \"东\",\n        \"南\",\n        \"西\",\n        \"北\",\n        \"东南\",\n        \"东北\",\n        \"西南\",\n        \"西北\",\n        \"南北\",\n        \"东西\",\n      ].map((it) => ({ label: it, value: it })),\n      propertyTypeOptions: [\"住宅\", \"公寓\", \"别墅\", \"商铺\", \"写字楼\"].map(\n        (it) => ({\n          label: it,\n          value: it,\n        })\n      ),\n      decorationTypeOptions: [\"毛坯\", \"简装\", \"精装\", \"豪装\"].map((it) => ({\n        label: it,\n        value: it,\n      })),\n      priceUnitOptions: [\n        { label: \"万\", value: \"万\" },\n        { label: \"元\", value: \"元\" },\n      ],\n      // 装修进度（可维护房源）\n      savingRenovation: false,\n      renovation: {\n        renovation_status: \"none\",\n        progress_percentage: 0,\n        current_stage: \"\",\n        start_date: \"\",\n        estimated_finish_date: \"\",\n        actual_finish_date: \"\",\n        notes: \"\",\n        status: 0,\n      },\n      renovationStatusOptions: [\n        { label: \"未装修\", value: \"none\" },\n        { label: \"装修中\", value: \"in_progress\" },\n        { label: \"已完成\", value: \"done\" },\n      ],\n      renovationStageOptions: [{ label: \"请选择\", value: \"\" }].concat(\n        [\n          \"设计\",\n          \"拆改\",\n          \"水电\",\n          \"泥瓦\",\n          \"木工\",\n          \"油漆\",\n          \"安装\",\n          \"软装\",\n          \"验收\",\n        ].map((it) => ({ label: it, value: it }))\n      ),\n      renovationMaterials: [],\n      renovationImages: [],\n      newMaterial: \"\",\n    };\n  },\n  computed: {\n    saleStatusIndex() {\n      const v = String(this.form.sale_status || \"on_sale\");\n      const idx = this.saleStatusOptions.findIndex((o) => o.value === v);\n      return idx >= 0 ? idx : 0;\n    },\n    priceUnitIndex() {\n      const v = String(this.form.price_unit || \"万\");\n      const idx = this.priceUnitOptions.findIndex((o) => o.value === v);\n      return idx >= 0 ? idx : 0;\n    },\n    buildYearIndex() {\n      const v = String(this.form.build_year || \"\");\n      const idx = this.buildYearOptions.findIndex((o) => o.value === v);\n      return idx >= 0 ? idx : 0;\n    },\n    floorLevelIndex() {\n      const v = String(this.form.floor_level || \"\");\n      const idx = this.floorLevelOptions.findIndex((o) => o.value === v);\n      return idx >= 0 ? idx : 0;\n    },\n    orientationIndex() {\n      const v = String(this.form.orientation || \"\");\n      const idx = this.orientationOptions.findIndex((o) => o.value === v);\n      return idx >= 0 ? idx : 0;\n    },\n    propertyTypeIndex() {\n      const v = String(this.form.property_type || \"\");\n      const idx = this.propertyTypeOptions.findIndex((o) => o.value === v);\n      return idx >= 0 ? idx : 0;\n    },\n    decorationTypeIndex() {\n      const v = String(this.form.decoration_type || \"\");\n      const idx = this.decorationTypeOptions.findIndex((o) => o.value === v);\n      return idx >= 0 ? idx : 0;\n    },\n    addressRegionText() {\n      const arr = Array.isArray(this.addressRegion) ? this.addressRegion : [];\n      const text = arr.filter((it) => String(it || \"\").trim()).join(\" / \");\n      return text || \"请选择省市区\";\n    },\n    renovationStatusIndex() {\n      const v = String(this.renovation.renovation_status || \"none\");\n      const idx = this.renovationStatusOptions.findIndex((o) => o.value === v);\n      return idx >= 0 ? idx : 0;\n    },\n    renovationStageIndex() {\n      const v = String(this.renovation.current_stage || \"\");\n      const idx = this.renovationStageOptions.findIndex((o) => o.value === v);\n      return idx >= 0 ? idx : 0;\n    },\n  },\n  onLoad(options) {\n    const id = Number((options && (options.id || options.ID)) || 0) || 0;\n    this.id = id;\n    this.bootstrap();\n  },\n  methods: {\n    // 兼容：上传接口可能返回相对路径（/resource/uploads/...），这里统一转为可展示的完整地址\n    toFullMediaUrl(url) {\n      const s = String(url || \"\").trim();\n      if (!s) return \"\";\n      if (\n        /^https?:\\/\\//i.test(s) ||\n        s.startsWith(\"wxfile://\") ||\n        s.startsWith(\"file://\")\n      )\n        return s;\n      const root = String(baseUrl || \"\").replace(/\\/+$/, \"\");\n      const path = s.startsWith(\"/\") ? s : `/${s}`;\n      return root ? `${root}${path}` : path;\n    },\n    goBack() {\n      uni.navigateBack();\n    },\n    async ensurePermission() {\n      const userStore = $store(\"user\");\n      const token = uni.getStorageSync(\"token\");\n      if (!token && !userStore.isLogin) {\n        uni.reLaunch({ url: \"/pages/login/login\" });\n        return false;\n      }\n      try {\n        const ui = userStore.userInfo || {};\n        // 兼容：老版本缓存的 userInfo 可能没有 can_manage_properties，需要强制刷新一次\n        if (!ui.id || typeof ui.can_manage_properties === \"undefined\") {\n          await userStore.getInfo();\n        }\n      } catch (e) {}\n      const canManage =\n        Number((userStore.userInfo || {}).can_manage_properties) === 1;\n      if (!canManage) {\n        uni.showModal({\n          title: \"提示\",\n          content: \"暂无房源维护权限，请联系后台管理员开启。\",\n          showCancel: false,\n          success: () => {\n            uni.navigateBack();\n          },\n        });\n        return false;\n      }\n      return true;\n    },\n    onSaleStatusChange(e) {\n      const idx = Number(e && e.detail && e.detail.value) || 0;\n      const opt = this.saleStatusOptions[idx] || this.saleStatusOptions[0];\n      this.form.sale_status = opt.value;\n    },\n    onPriceUnitChange(e) {\n      const idx = Number(e && e.detail && e.detail.value) || 0;\n      const opt = this.priceUnitOptions[idx] || this.priceUnitOptions[0];\n      this.form.price_unit = (opt && opt.value) || \"万\";\n    },\n    // 页面初始化：权限校验 + 下拉选项缓存 + 回显\n    async bootstrap() {\n      const ok = await this.ensurePermission();\n      if (!ok) return;\n      await this.loadFormOptions();\n      if (this.id) {\n        await this.loadContent();\n        await this.loadRenovation();\n      }\n    },\n    // 首次加载表单下拉项时写入缓存；有缓存直接使用\n    async loadFormOptions() {\n      const userStore = $store(\"user\");\n      const businessId = Number((userStore.userInfo || {}).business_id) || 1;\n      const cacheKey = `wx_property_form_options_v2_${businessId}`;\n      const cached = uni.getStorageSync(cacheKey);\n      if (cached && typeof cached === \"object\") {\n        this.applyFormOptions(cached);\n        return;\n      }\n\n      const res = await propertyApi.getFormOptions({});\n      if (!res || res.code !== 0) return;\n      const data = res.data || {};\n      this.applyFormOptions(data);\n      try {\n        uni.setStorageSync(cacheKey, data);\n      } catch (e) {}\n    },\n    applyFormOptions(data) {\n      const normalize = (arr) =>\n        (Array.isArray(arr) ? arr : [])\n          .map((it) => ({\n            label: String((it && it.label) || \"\").trim(),\n            value: String((it && it.value) || \"\").trim(),\n          }))\n          .filter((it) => it.label && it.value);\n\n      const sale = normalize(data.sale_status);\n      if (sale.length) this.saleStatusOptions = sale;\n\n      const unit = normalize(data.price_unit);\n      if (unit.length) this.priceUnitOptions = unit;\n\n      const floor = normalize(data.floor_level);\n      if (floor.length) this.floorLevelOptions = floor;\n\n      const ori = normalize(data.orientation);\n      if (ori.length) this.orientationOptions = ori;\n\n      const pt = normalize(data.property_type);\n      if (pt.length) this.propertyTypeOptions = pt;\n\n      const deco = normalize(data.decoration_type);\n      if (deco.length) this.decorationTypeOptions = deco;\n\n      const stages = normalize(data.renovation_stage);\n      if (stages.length)\n        this.renovationStageOptions = [{ label: \"请选择\", value: \"\" }].concat(\n          stages\n        );\n\n      // 兜底：当前值不在选项内时，回退到第一个选项\n      const fixValue = (key, options, fallback) => {\n        const v = String(this.form[key] || \"\").trim();\n        const hit = (options || []).some((o) => String(o.value) === v);\n        if (!hit)\n          this.form[key] =\n            (options && options[0] && options[0].value) || fallback;\n      };\n      fixValue(\"sale_status\", this.saleStatusOptions, \"on_sale\");\n      fixValue(\"price_unit\", this.priceUnitOptions, \"万\");\n      fixValue(\"floor_level\", this.floorLevelOptions, \"\");\n      fixValue(\"orientation\", this.orientationOptions, \"\");\n      fixValue(\"property_type\", this.propertyTypeOptions, \"\");\n      fixValue(\"decoration_type\", this.decorationTypeOptions, \"\");\n\n      // 装修工序：允许历史数据不在选项内时追加显示，避免 picker 显示异常\n      const stageVal = String(this.renovation.current_stage || \"\").trim();\n      if (\n        stageVal &&\n        !(this.renovationStageOptions || []).some(\n          (o) => String(o.value) === stageVal\n        )\n      ) {\n        this.renovationStageOptions = (\n          this.renovationStageOptions || []\n        ).concat([{ label: stageVal, value: stageVal }]);\n      }\n    },\n    onBuildYearChange(e) {\n      const idx = Number(e && e.detail && e.detail.value) || 0;\n      const opt = this.buildYearOptions[idx] || this.buildYearOptions[0];\n      this.form.build_year = opt.value;\n    },\n    onFloorLevelChange(e) {\n      const idx = Number(e && e.detail && e.detail.value) || 0;\n      const opt = this.floorLevelOptions[idx] || this.floorLevelOptions[0];\n      this.form.floor_level = opt.value;\n    },\n    onOrientationChange(e) {\n      const idx = Number(e && e.detail && e.detail.value) || 0;\n      const opt = this.orientationOptions[idx] || this.orientationOptions[0];\n      this.form.orientation = opt.value;\n    },\n    onPropertyTypeChange(e) {\n      const idx = Number(e && e.detail && e.detail.value) || 0;\n      const opt = this.propertyTypeOptions[idx] || this.propertyTypeOptions[0];\n      this.form.property_type = opt.value;\n    },\n    onDecorationTypeChange(e) {\n      const idx = Number(e && e.detail && e.detail.value) || 0;\n      const opt =\n        this.decorationTypeOptions[idx] || this.decorationTypeOptions[0];\n      this.form.decoration_type = opt.value;\n    },\n    onAddressRegionChange(e) {\n      const v = (e && e.detail && e.detail.value) || [];\n      if (Array.isArray(v)) this.addressRegion = v;\n    },\n    buildFullAddress() {\n      const region = Array.isArray(this.addressRegion)\n        ? this.addressRegion\n            .map((it) => String(it || \"\").trim())\n            .filter(Boolean)\n        : [];\n      const detail = String(this.addressDetail || \"\").trim();\n      return [...region, detail].filter(Boolean).join(\" \");\n    },\n    initAddressUIFromAddress(address) {\n      const raw = String(address || \"\").trim();\n      this.addressRegion = [\"\", \"\", \"\"];\n      this.addressDetail = \"\";\n      if (!raw) return;\n      const parts = raw.split(/\\\\s+/).filter(Boolean);\n      if (parts.length >= 3) {\n        this.addressRegion = [parts[0] || \"\", parts[1] || \"\", parts[2] || \"\"];\n        this.addressDetail = parts.slice(3).join(\" \");\n        return;\n      }\n      this.addressDetail = raw;\n    },\n    onRenovationStageChange(e) {\n      const idx = Number(e && e.detail && e.detail.value) || 0;\n      const opt =\n        this.renovationStageOptions[idx] || this.renovationStageOptions[0];\n      this.renovation.current_stage = (opt && opt.value) || \"\";\n    },\n    async loadContent() {\n      const res = await propertyApi.getManageContent({ id: this.id });\n      if (!res || res.code !== 0) return;\n      const data = res.data || {};\n      this.form = {\n        ...this.form,\n        ...data,\n      };\n      this.tags = Array.isArray(data.tags) ? data.tags : [];\n      this.images = Array.isArray(data.images) ? data.images : [];\n      if (this.form.build_year)\n        this.form.build_year = String(this.form.build_year);\n      if (this.form.total_floors)\n        this.form.total_floors = String(this.form.total_floors);\n      if (this.form.weigh || this.form.weigh === 0)\n        this.form.weigh = String(this.form.weigh);\n      if (\n        this.form.receiver_price === null ||\n        typeof this.form.receiver_price === \"undefined\"\n      ) {\n        this.form.receiver_price = \"\";\n      }\n      if (\n        this.form.commission_rate === null ||\n        typeof this.form.commission_rate === \"undefined\"\n      ) {\n        this.form.commission_rate = \"\";\n      }\n      if (\n        this.form.commission_reward === null ||\n        typeof this.form.commission_reward === \"undefined\"\n      ) {\n        this.form.commission_reward = \"\";\n      }\n      // 地址拆分：用于省市区选择 + 详细地址输入\n      this.initAddressUIFromAddress(this.form.address);\n      // 兜底：封面未设置时，用第一张图\n      if (!this.form.cover_image && this.images.length > 0) {\n        this.form.cover_image = this.images[0];\n      }\n    },\n    async loadRenovation() {\n      if (!this.id) return;\n      const res = await propertyApi.getManageRenovation({\n        property_id: this.id,\n      });\n      if (!res || res.code !== 0) return;\n      const data = res.data || {};\n      this.renovation = {\n        ...this.renovation,\n        ...data,\n      };\n      this.renovationMaterials = Array.isArray(data.materials)\n        ? data.materials\n        : [];\n      this.renovationImages = Array.isArray(data.images) ? data.images : [];\n\n      // 兜底类型修正\n      if (\n        this.renovation.progress_percentage === null ||\n        typeof this.renovation.progress_percentage === \"undefined\"\n      ) {\n        this.renovation.progress_percentage = 0;\n      }\n      if (\n        this.renovation.renovation_status !== \"none\" &&\n        this.renovation.renovation_status !== \"in_progress\" &&\n        this.renovation.renovation_status !== \"done\"\n      ) {\n        this.renovation.renovation_status = \"none\";\n      }\n\n      // 兜底：阶段值不在下拉里时，追加一项用于回显\n      const stageVal = String(this.renovation.current_stage || \"\").trim();\n      if (\n        stageVal &&\n        !(this.renovationStageOptions || []).some(\n          (o) => String(o.value) === stageVal\n        )\n      ) {\n        this.renovationStageOptions = (\n          this.renovationStageOptions || []\n        ).concat([{ label: stageVal, value: stageVal }]);\n      }\n    },\n    addTag() {\n      const t = String(this.newTag || \"\").trim();\n      if (!t) {\n        uni.showToast({ title: \"请输入标签\", icon: \"none\" });\n        return;\n      }\n      if (this.tags.includes(t)) {\n        this.newTag = \"\";\n        return;\n      }\n      if (this.tags.length >= 6) {\n        uni.showToast({ title: \"最多6个标签\", icon: \"none\" });\n        return;\n      }\n      this.tags = this.tags.concat([t]);\n      this.newTag = \"\";\n    },\n    removeTag(idx) {\n      this.tags = this.tags.filter((_, i) => i !== idx);\n    },\n    openImageActions(idx) {\n      const img = this.images[idx];\n      if (!img) return;\n      const isCover = img === this.form.cover_image;\n      const list = isCover ? [\"删除\"] : [\"设为封面\", \"删除\"];\n      uni.showActionSheet({\n        itemList: list,\n        success: (res) => {\n          const tap = Number(res.tapIndex);\n          if (!isCover && tap === 0) {\n            this.form.cover_image = img;\n            return;\n          }\n          const delIndex = isCover ? 0 : 1;\n          if (tap === delIndex) {\n            this.images = this.images.filter((_, i) => i !== idx);\n            if (this.form.cover_image === img) {\n              this.form.cover_image = this.images[0] || \"\";\n            }\n          }\n        },\n      });\n    },\n    openVideoActions() {\n      const has = !!this.form.video_url;\n      const list = has ? [\"更换视频\", \"移除视频\"] : [\"上传视频\"];\n      uni.showActionSheet({\n        itemList: list,\n        success: async (res) => {\n          const tap = Number(res.tapIndex);\n          if (!has) {\n            await this.pickVideo();\n            return;\n          }\n          if (tap === 0) await this.pickVideo();\n          if (tap === 1) this.form.video_url = \"\";\n        },\n      });\n    },\n    onRenovationStatusChange(e) {\n      const idx = Number(e && e.detail && e.detail.value) || 0;\n      const opt =\n        this.renovationStatusOptions[idx] || this.renovationStatusOptions[0];\n      this.renovation.renovation_status = opt.value;\n      if (opt.value === \"none\") {\n        this.renovation.progress_percentage = 0;\n        this.renovation.current_stage = \"\";\n        this.renovation.start_date = \"\";\n        this.renovation.estimated_finish_date = \"\";\n        this.renovation.actual_finish_date = \"\";\n        this.renovation.notes = \"\";\n        this.renovationMaterials = [];\n        this.renovationImages = [];\n      }\n      if (opt.value === \"done\") {\n        this.renovation.progress_percentage = 100;\n      }\n    },\n    addMaterial() {\n      const t = String(this.newMaterial || \"\").trim();\n      if (!t) {\n        uni.showToast({ title: \"请输入材料\", icon: \"none\" });\n        return;\n      }\n      if (this.renovationMaterials.includes(t)) {\n        this.newMaterial = \"\";\n        return;\n      }\n      if (this.renovationMaterials.length >= 10) {\n        uni.showToast({ title: \"最多10个材料\", icon: \"none\" });\n        return;\n      }\n      this.renovationMaterials = this.renovationMaterials.concat([t]);\n      this.newMaterial = \"\";\n    },\n    removeMaterial(idx) {\n      this.renovationMaterials = this.renovationMaterials.filter(\n        (_, i) => i !== idx\n      );\n    },\n    openRenovationImageActions(idx) {\n      const img = this.renovationImages[idx];\n      if (!img) return;\n      uni.showActionSheet({\n        itemList: [\"删除\"],\n        success: () => {\n          this.renovationImages = this.renovationImages.filter(\n            (_, i) => i !== idx\n          );\n        },\n      });\n    },\n    pickRenovationImages() {\n      if (this.uploading) return;\n      if (!this.id) {\n        uni.showToast({ title: \"请先保存房源\", icon: \"none\" });\n        return;\n      }\n      uni.chooseImage({\n        count: 9,\n        sizeType: [\"compressed\"],\n        sourceType: [\"album\", \"camera\"],\n        success: async (res) => {\n          const files = (res && res.tempFilePaths) || [];\n          if (!files.length) return;\n          await this.uploadFiles(files, \"image\", \"renovation\");\n        },\n      });\n    },\n    pickImages() {\n      if (this.uploading) return;\n      uni.chooseImage({\n        count: 9,\n        sizeType: [\"compressed\"],\n        sourceType: [\"album\", \"camera\"],\n        success: async (res) => {\n          const files = (res && res.tempFilePaths) || [];\n          if (!files.length) return;\n          await this.uploadFiles(files, \"image\", \"property\");\n        },\n      });\n    },\n    pickVideo() {\n      if (this.uploading) return Promise.resolve();\n      return new Promise((resolve) => {\n        uni.chooseVideo({\n          sourceType: [\"album\", \"camera\"],\n          maxDuration: 60,\n          compressed: true,\n          success: async (res) => {\n            const filePath =\n              res && (res.tempFilePath || res.tempFilePaths?.[0]);\n            if (!filePath) return resolve();\n            await this.uploadFiles([filePath], \"video\", \"property\");\n            resolve();\n          },\n          fail: () => resolve(),\n        });\n      });\n    },\n    uploadFiles(filePaths = [], filetype = \"image\", target = \"property\") {\n      if (!Array.isArray(filePaths) || filePaths.length === 0)\n        return Promise.resolve();\n      return new Promise(async (resolve) => {\n        this.uploading = true;\n        uni.showLoading({ title: \"上传中\", mask: true });\n        try {\n          for (let i = 0; i < filePaths.length; i++) {\n            const fp = filePaths[i];\n            const out = await this.uploadSingle(fp, filetype).catch(() => null);\n            const url = out && out.code === 0 && out.data ? out.data.url : \"\";\n            if (!url) continue;\n            if (filetype === \"video\") {\n              this.form.video_url = url;\n            } else {\n              if (target === \"renovation\") {\n                this.renovationImages = this.renovationImages.concat([url]);\n              } else {\n                this.images = this.images.concat([url]);\n                if (!this.form.cover_image) this.form.cover_image = url;\n              }\n            }\n          }\n        } finally {\n          uni.hideLoading();\n          this.uploading = false;\n          resolve();\n        }\n      });\n    },\n    uploadSingle(filePath, filetype) {\n      return new Promise((resolve, reject) => {\n        const token = uni.getStorageSync(\"token\");\n        const timestamp = Math.floor(Date.now() / 1000);\n        const passstr = md5(import.meta.env.GF_API_SECRET + timestamp);\n        const header = {\n          Accept: \"text/json\",\n          Businessid: import.meta.env.GF_BUSINESUSSID,\n          apiverify: base64Encode(passstr + \"#\" + timestamp),\n        };\n        if (token) header.Authorization = `${token}`;\n\n        uni.uploadFile({\n          url: `${baseUrl}/common/upload/upFile`,\n          filePath,\n          name: \"file\",\n          formData: { filetype },\n          header,\n          success: (upRes) => {\n            try {\n              const raw = upRes && upRes.data ? upRes.data : \"{}\";\n              const out = typeof raw === \"string\" ? JSON.parse(raw) : raw;\n              if (!out || out.code !== 0) {\n                uni.showToast({\n                  title: (out && out.message) || \"上传失败\",\n                  icon: \"none\",\n                });\n                reject(out);\n                return;\n              }\n              resolve(out);\n            } catch (e) {\n              uni.showToast({ title: \"解析上传结果失败\", icon: \"none\" });\n              reject(e);\n            }\n          },\n          fail: (err) => {\n            uni.showToast({ title: \"上传失败\", icon: \"none\" });\n            reject(err);\n          },\n        });\n      });\n    },\n    pickLocation() {\n      uni.chooseLocation({\n        success: (res) => {\n          if (!res) return;\n          const lat = Number(res.latitude);\n          const lng = Number(res.longitude);\n          if (isFinite(lat) && isFinite(lng)) {\n            this.form.latitude = lat;\n            this.form.longitude = lng;\n          }\n          // 兼容：有 name 则给到小区名称\n          if (res.name && !this.form.community_name)\n            this.form.community_name = String(res.name);\n          if (res.address && !String(this.addressDetail || \"\").trim())\n            this.addressDetail = String(res.address);\n        },\n        fail: () => {\n          uni.showToast({ title: \"无法打开地图\", icon: \"none\" });\n        },\n      });\n    },\n    async save() {\n      if (this.saving || this.uploading) return;\n      const title = String(this.form.title || \"\").trim();\n      if (!title) {\n        uni.showToast({ title: \"请填写房源标题\", icon: \"none\" });\n        return;\n      }\n      this.saving = true;\n      try {\n        const payload = {\n          ...(this.id ? { id: this.id } : {}),\n          title,\n          sale_status: this.form.sale_status,\n          price: this.form.price,\n          price_unit: this.form.price_unit,\n          area: this.form.area,\n          rooms: Number(this.form.rooms || 0),\n          halls: Number(this.form.halls || 0),\n          bathrooms: Number(this.form.bathrooms || 0),\n          community_name: String(this.form.community_name || \"\").trim(),\n          address: this.buildFullAddress(),\n          latitude: this.form.latitude || \"\",\n          longitude: this.form.longitude || \"\",\n          tags: this.tags,\n          images: this.images,\n          cover_image: this.form.cover_image || \"\",\n          video_url: this.form.video_url || \"\",\n          allow_image_download:\n            Number(this.form.allow_image_download) === 1 ? 1 : 0,\n          allow_video_download:\n            Number(this.form.allow_video_download) === 1 ? 1 : 0,\n          build_year: this.form.build_year ? Number(this.form.build_year) : 0,\n          floor_level: String(this.form.floor_level || \"\").trim(),\n          total_floors: Number(this.form.total_floors || 0),\n          orientation: String(this.form.orientation || \"\").trim(),\n          property_type: String(this.form.property_type || \"\").trim(),\n          decoration_type: String(this.form.decoration_type || \"\").trim(),\n          owner_name: String(this.form.owner_name || \"\").trim(),\n          owner_phone: String(this.form.owner_phone || \"\").trim(),\n          receiver_name: String(this.form.receiver_name || \"\").trim(),\n          receiver_phone: String(this.form.receiver_phone || \"\").trim(),\n          receiver_price: this.form.receiver_price,\n          commission_rate: this.form.commission_rate,\n          commission_reward: this.form.commission_reward,\n          weigh: Number(this.form.weigh || 0),\n          hot_status: Number(this.form.hot_status) === 1 ? 1 : 0,\n          status: Number(this.form.status) === 0 ? 0 : 1,\n        };\n        const res = await propertyApi.saveManage(payload);\n        if (!res || res.code !== 0) return;\n\n        const createdNew = !this.id;\n        const nid = Number(res && res.data && res.data.id) || 0;\n        if (!this.id && nid) {\n          this.id = nid;\n        }\n\n        // 装修信息跟随底部保存统一提交\n        let renovationSaved = true;\n        if (this.id) {\n          renovationSaved = await this.saveRenovation({\n            silent: true,\n            reload: false,\n          });\n        }\n\n        // 新增后刷新一次装修数据，保证页面状态与服务端一致\n        if (createdNew && this.id) {\n          await this.loadRenovation();\n        }\n\n        if (renovationSaved) {\n          uni.showToast({ title: \"保存成功\", icon: \"none\" });\n        } else {\n          uni.showToast({ title: \"房源已保存，装修保存失败\", icon: \"none\" });\n        }\n      } finally {\n        this.saving = false;\n      }\n    },\n    async saveRenovation(options = {}) {\n      const silent = !!(options && options.silent);\n      const reload = !options || options.reload !== false;\n\n      if (!this.id) {\n        if (!silent) uni.showToast({ title: \"请先保存房源\", icon: \"none\" });\n        return false;\n      }\n      if (this.savingRenovation || this.uploading) return false;\n\n      const status = String(this.renovation.renovation_status || \"none\");\n      const progress = Number(this.renovation.progress_percentage || 0);\n      if (!isFinite(progress) || progress < 0 || progress > 100) {\n        if (!silent)\n          uni.showToast({ title: \"进度需在0-100之间\", icon: \"none\" });\n        return false;\n      }\n\n      this.savingRenovation = true;\n      try {\n        const payload = {\n          property_id: this.id,\n          renovation_status: status,\n          progress_percentage: Math.floor(progress),\n          current_stage: String(this.renovation.current_stage || \"\").trim(),\n          start_date: this.renovation.start_date || \"\",\n          estimated_finish_date: this.renovation.estimated_finish_date || \"\",\n          actual_finish_date: this.renovation.actual_finish_date || \"\",\n          materials: this.renovationMaterials,\n          images: this.renovationImages,\n          notes: String(this.renovation.notes || \"\").trim(),\n          status: Number(this.renovation.status) === 1 ? 1 : 0,\n        };\n        const res = await propertyApi.saveManageRenovation(payload);\n        if (!res || res.code !== 0) return false;\n        if (!silent) {\n          uni.showToast({ title: \"保存成功\", icon: \"none\" });\n        }\n        if (reload) {\n          await this.loadRenovation();\n        }\n        return true;\n      } finally {\n        this.savingRenovation = false;\n      }\n    },\n    preview() {\n      if (!this.id) return;\n      uni.navigateTo({\n        url: `/pages/property_detail/property_detail?id=${this.id}`,\n      });\n    },\n  },\n};\n</script>\n\n<style>\n.pe {\n  --pe-bg-a: #edf3fa;\n  --pe-bg-b: #f9fbff;\n  --pe-card-bg: rgba(255, 255, 255, 0.9);\n  --pe-line: #dbe6f2;\n  --pe-text-1: #0f172a;\n  --pe-text-2: #334155;\n  --pe-text-3: #64748b;\n  --pe-accent-1: #2d9cf0;\n  --pe-accent-2: #2563eb;\n\n  height: 100vh;\n  background: linear-gradient(\n    160deg,\n    var(--pe-bg-a) 0%,\n    var(--pe-bg-b) 52%,\n    #f1f6fd 100%\n  );\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  position: relative;\n}\n\n.pe::before {\n  content: \"\";\n  position: absolute;\n  inset: 0;\n  pointer-events: none;\n  background: radial-gradient(\n      560rpx 360rpx at -12% -6%,\n      rgba(45, 156, 240, 0.16),\n      transparent 62%\n    ),\n    radial-gradient(\n      680rpx 400rpx at 112% 4%,\n      rgba(37, 99, 235, 0.12),\n      transparent 66%\n    );\n  z-index: 0;\n}\n\n.icon-btn {\n  width: 72rpx;\n  height: 72rpx;\n  border-radius: 40rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border: 1px solid rgba(255, 255, 255, 0.95);\n  background: linear-gradient(145deg, #ffffff, #edf3fa);\n  box-shadow: 8rpx 8rpx 16rpx rgba(148, 163, 184, 0.18),\n    -8rpx -8rpx 16rpx rgba(255, 255, 255, 0.94);\n  color: var(--pe-text-1);\n}\n\n.icon-btn.primary {\n  background: linear-gradient(135deg, #2d9cf0, #2563eb);\n  border: none;\n  color: #ffffff;\n  box-shadow: 0 12rpx 28rpx rgba(37, 99, 235, 0.22);\n}\n\n.content {\n  flex: 1;\n  overflow: hidden;\n  position: relative;\n  z-index: 1;\n}\n\n.card {\n  margin: 18rpx 24rpx 0;\n  padding: 22rpx 20rpx 16rpx;\n  background: var(--pe-card-bg);\n  border-radius: 30rpx;\n  border: 1px solid rgba(255, 255, 255, 0.95);\n  box-shadow: 14rpx 14rpx 28rpx rgba(148, 163, 184, 0.2),\n    -14rpx -14rpx 28rpx rgba(255, 255, 255, 0.9);\n  backdrop-filter: blur(8px);\n  -webkit-backdrop-filter: blur(8px);\n  position: relative;\n  z-index: 1;\n}\n\n.card::before {\n  content: \"\";\n  position: absolute;\n  top: 0;\n  left: 22rpx;\n  width: 86rpx;\n  height: 8rpx;\n  border-radius: 0 0 999rpx 999rpx;\n  background: linear-gradient(135deg, var(--pe-accent-1), var(--pe-accent-2));\n  opacity: 0.75;\n}\n\n.card-title {\n  font-size: 31rpx;\n  font-weight: 800;\n  color: var(--pe-text-1);\n  margin-bottom: 16rpx;\n  letter-spacing: 0.2rpx;\n}\n\n.hint {\n  font-size: 24rpx;\n  color: #76879d;\n  margin-top: -4rpx;\n  margin-bottom: 14rpx;\n  line-height: 1.5;\n}\n.hint.small {\n  margin: 0;\n}\n.hint.small.tip {\n  margin-top: 10rpx;\n  color: #64748b;\n}\n\n.form-row {\n  display: flex;\n  flex-direction: column;\n  gap: 10rpx;\n  margin-bottom: 14rpx;\n}\n\n.label {\n  font-size: 24rpx;\n  color: var(--pe-text-2);\n  font-weight: 700;\n  letter-spacing: 0.2rpx;\n}\n.label.required::after {\n  content: \" *\";\n  color: #ef4444;\n}\n\n.input {\n  height: 78rpx;\n  border-radius: 20rpx;\n  border: 1px solid #e5edf7;\n  background: linear-gradient(145deg, #f9fbfe, #eef3f9);\n  box-shadow: inset 6rpx 6rpx 12rpx rgba(208, 220, 234, 0.36),\n    inset -6rpx -6rpx 12rpx rgba(255, 255, 255, 0.95);\n  padding: 0 16rpx;\n  font-size: 28rpx;\n  color: var(--pe-text-1);\n  box-sizing: border-box;\n}\n\n.textarea {\n  min-height: 160rpx;\n  border-radius: 20rpx;\n  border: 1px solid #e5edf7;\n  background: linear-gradient(145deg, #f9fbfe, #eef3f9);\n  box-shadow: inset 6rpx 6rpx 12rpx rgba(208, 220, 234, 0.34),\n    inset -6rpx -6rpx 12rpx rgba(255, 255, 255, 0.92);\n  padding: 14rpx 16rpx;\n  font-size: 28rpx;\n  color: var(--pe-text-1);\n  box-sizing: border-box;\n}\n\n.placeholder {\n  color: #94a3b8;\n}\n\n.grid {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 14rpx;\n}\n\n.picker {\n  height: 78rpx;\n  border-radius: 20rpx;\n  border: 1px solid #e5edf7;\n  background: linear-gradient(145deg, #f9fbfe, #eef3f9);\n  box-shadow: inset 6rpx 6rpx 12rpx rgba(208, 220, 234, 0.32),\n    inset -6rpx -6rpx 12rpx rgba(255, 255, 255, 0.9);\n  padding: 0 14rpx;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n}\n\n.picker-text {\n  font-size: 28rpx;\n  color: var(--pe-text-1);\n}\n\n.picker-ic {\n  font-size: 36rpx !important;\n  color: #7f93aa;\n}\n.picker.disabled {\n  background: linear-gradient(145deg, #f0f4fa, #e9f0f8);\n  border-color: #d8e2ef;\n  opacity: 0.9;\n}\n\n.price-row {\n  display: flex;\n  gap: 10rpx;\n  align-items: center;\n}\n\n.unit-picker {\n  width: 140rpx;\n  height: 78rpx;\n  border-radius: 20rpx;\n  border: 1px solid #e5edf7;\n  background: linear-gradient(145deg, #f9fbfe, #eef3f9);\n  box-shadow: inset 6rpx 6rpx 12rpx rgba(208, 220, 234, 0.32),\n    inset -6rpx -6rpx 12rpx rgba(255, 255, 255, 0.9);\n  padding: 0 12rpx;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  box-sizing: border-box;\n}\n\n.unit-text {\n  font-size: 28rpx;\n  color: var(--pe-text-1);\n}\n.unit-ic {\n  font-size: 34rpx !important;\n  color: #7f93aa;\n}\n\n.room-row {\n  display: flex;\n  align-items: center;\n  gap: 8rpx;\n}\n\n.mini {\n  width: 120rpx;\n  height: 78rpx;\n  border-radius: 20rpx;\n  border: 1px solid #e5edf7;\n  background: linear-gradient(145deg, #f9fbfe, #eef3f9);\n  box-shadow: inset 6rpx 6rpx 12rpx rgba(208, 220, 234, 0.32),\n    inset -6rpx -6rpx 12rpx rgba(255, 255, 255, 0.9);\n  padding: 0 12rpx;\n  font-size: 28rpx;\n  color: var(--pe-text-1);\n  box-sizing: border-box;\n}\n\n.mini-suffix {\n  font-size: 26rpx;\n  color: #64748b;\n  margin-right: 8rpx;\n}\n\n.media-grid {\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 12rpx;\n}\n\n.media-item {\n  height: 200rpx;\n  border-radius: 20rpx;\n  overflow: hidden;\n  position: relative;\n  background: linear-gradient(145deg, #f4f8fd, #e9f0f8);\n  border: 1px solid #dde8f4;\n  box-shadow: 8rpx 8rpx 16rpx rgba(169, 182, 199, 0.2),\n    -6rpx -6rpx 14rpx rgba(255, 255, 255, 0.78);\n}\n\n.media-item.add {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-direction: column;\n  gap: 8rpx;\n  background: linear-gradient(145deg, #fbfdff, #edf4fb);\n}\n\n.media-img {\n  width: 100%;\n  height: 100%;\n}\n\n.badge {\n  position: absolute;\n  left: 10rpx;\n  top: 10rpx;\n  padding: 6rpx 12rpx;\n  border-radius: 999rpx;\n  font-size: 22rpx;\n  background: rgba(37, 99, 235, 0.85);\n  color: #ffffff;\n  backdrop-filter: blur(8px);\n}\n\n.add-ic {\n  font-size: 54rpx !important;\n  color: #2563eb;\n}\n\n.add-text {\n  font-size: 24rpx;\n  color: #2563eb;\n  font-weight: 700;\n}\n\n.switch-row {\n  margin-top: 14rpx;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 14rpx 4rpx 0;\n  border-top: 1px dashed #dce6f2;\n}\n\n.switch-left {\n  display: flex;\n  align-items: center;\n  gap: 10rpx;\n  color: var(--pe-text-2);\n}\n\n.sw-ic {\n  font-size: 34rpx !important;\n  color: #5f7a98;\n}\n\n.sw-text {\n  font-size: 26rpx;\n  font-weight: 700;\n}\n\n.video-box {\n  height: 280rpx;\n  border-radius: 24rpx;\n  overflow: hidden;\n  border: 1px solid #dbe6f3;\n  background: linear-gradient(160deg, #0f2237, #132f4b 56%, #0f1d31);\n  box-shadow: inset 0 0 0 1rpx rgba(255, 255, 255, 0.04);\n}\n\n.video-empty {\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 16rpx;\n  color: rgba(255, 255, 255, 0.9);\n}\n\n.video-ic {\n  font-size: 64rpx !important;\n  opacity: 0.85;\n}\n\n.video-texts {\n  display: flex;\n  flex-direction: column;\n  gap: 6rpx;\n}\n\n.video-title {\n  font-size: 30rpx;\n  font-weight: 800;\n}\n\n.video-sub {\n  font-size: 24rpx;\n  opacity: 0.8;\n}\n\n.video {\n  width: 100%;\n  height: 100%;\n}\n\n.tag-row {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10rpx;\n}\n\n.tag {\n  display: flex;\n  align-items: center;\n  gap: 8rpx;\n  padding: 10rpx 14rpx;\n  border-radius: 999rpx;\n  background: linear-gradient(145deg, #f8fbff, #edf3fb);\n  border: 1px solid #dce6f2;\n  box-shadow: 6rpx 6rpx 12rpx rgba(177, 190, 206, 0.14),\n    -4rpx -4rpx 10rpx rgba(255, 255, 255, 0.86);\n}\n\n.tag-text {\n  font-size: 24rpx;\n  color: #0f172a;\n  font-weight: 700;\n}\n\n.tag-x {\n  font-size: 26rpx !important;\n  color: #64748b;\n}\n\n.tag-add {\n  margin-top: 12rpx;\n  display: flex;\n  gap: 12rpx;\n  align-items: center;\n}\n\n.btn {\n  height: 78rpx;\n  border-radius: 20rpx;\n  border: 1px solid #dce7f3;\n  background: linear-gradient(145deg, #ffffff, #eff5fc);\n  font-size: 26rpx;\n  color: var(--pe-text-1);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 0 18rpx;\n  box-shadow: 8rpx 8rpx 16rpx rgba(169, 183, 201, 0.18),\n    -6rpx -6rpx 14rpx rgba(255, 255, 255, 0.9);\n}\n.btn::after {\n  border: none;\n}\n.btn.add {\n  background: linear-gradient(135deg, var(--pe-accent-1), var(--pe-accent-2));\n  border: none;\n  color: #ffffff;\n  font-weight: 800;\n  min-width: 140rpx;\n  box-shadow: 0 12rpx 24rpx rgba(37, 99, 235, 0.24);\n}\n\n.btn.ghost {\n  background: linear-gradient(145deg, #f9fbff, #edf4fc);\n  color: #1f6ed7;\n  border-color: rgba(37, 99, 235, 0.2);\n  min-width: 160rpx;\n}\n\n.renovation-actions {\n  margin-top: 12rpx;\n  display: flex;\n  justify-content: flex-end;\n}\n\n.coord-row {\n  margin-top: 12rpx;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 12rpx;\n  padding-top: 10rpx;\n  border-top: 1px dashed #dce6f2;\n}\n\n.coord-left {\n  display: flex;\n  align-items: center;\n  gap: 10rpx;\n  min-width: 0;\n}\n\n.coord-ic {\n  font-size: 34rpx !important;\n  color: #5f7a98;\n}\n\n.coord-text {\n  font-size: 24rpx;\n  color: var(--pe-text-2);\n  font-weight: 700;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.bottom-spacer {\n  height: calc(env(safe-area-inset-bottom) + 120rpx);\n}\n\n.footer {\n  padding: 14rpx 24rpx calc(env(safe-area-inset-bottom) + 14rpx);\n  background: rgba(242, 248, 255, 0.88);\n  backdrop-filter: blur(12px);\n  border-top: 1rpx solid rgba(214, 227, 242, 0.9);\n  box-shadow: 0 -10rpx 24rpx rgba(113, 136, 162, 0.12);\n  display: flex;\n  gap: 14rpx;\n  position: relative;\n  z-index: 2;\n}\n\n.footer-btn {\n  flex: 1;\n  height: 88rpx;\n  border-radius: 24rpx;\n  font-size: 28rpx;\n  font-weight: 800;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border: 1px solid #dce7f3;\n  background: linear-gradient(145deg, #ffffff, #eff5fc);\n  color: var(--pe-text-1);\n  box-shadow: 8rpx 8rpx 16rpx rgba(169, 183, 201, 0.2),\n    -6rpx -6rpx 14rpx rgba(255, 255, 255, 0.88);\n}\n.footer-btn::after {\n  border: none;\n}\n\n.footer-btn.primary {\n  border: none;\n  color: #ffffff;\n  background: linear-gradient(135deg, var(--pe-accent-1), var(--pe-accent-2));\n  box-shadow: 0 14rpx 28rpx rgba(37, 99, 235, 0.28);\n}\n\n.footer-btn.ghost {\n  background: linear-gradient(145deg, #f9fbff, #edf4fc);\n  color: #1f6ed7;\n  border-color: rgba(37, 99, 235, 0.2);\n}\n\n.footer-btn:disabled,\n.btn:disabled {\n  opacity: 0.58;\n  box-shadow: none;\n}\n</style>\n","import MiniProgramPage from 'E:/Work/Progect/GoFly-admin/main-admin/web/wxapp/pages/property_manage/property_edit.vue'\nwx.createPage(MiniProgramPage)"],"names":["base64Encode","str","buf","s","bytes","i","length","codePoint","charCodeAt","push","Uint8Array","utf8ToBytes","buffer","wx","wx$1","arrayBufferToBase64","uni","index$1","_sfc_main","components","TopHeader","data","curYear","Date","getFullYear","id","saving","uploading","form","title","price","price_unit","area","rooms","halls","bathrooms","build_year","floor_level","total_floors","orientation","property_type","decoration_type","community_name","address","latitude","longitude","tags","images","cover_image","video_url","allow_image_download","allow_video_download","sale_status","owner_name","owner_phone","receiver_name","receiver_phone","receiver_price","commission_rate","commission_reward","weigh","hot_status","has_smart_lock","status","newTag","addressRegion","addressDetail","saleStatusOptions","label","value","buildYearOptions","concat","Array","from","map","_","y","String","floorLevelOptions","orientationOptions","it","propertyTypeOptions","decorationTypeOptions","priceUnitOptions","savingRenovation","renovation","renovation_status","progress_percentage","current_stage","start_date","estimated_finish_date","actual_finish_date","notes","renovationStatusOptions","renovationStageOptions","renovationMaterials","renovationImages","newMaterial","computed","saleStatusIndex","v","this","idx","findIndex","o","priceUnitIndex","buildYearIndex","floorLevelIndex","orientationIndex","propertyTypeIndex","decorationTypeIndex","addressRegionText","isArray","filter","trim","join","renovationStatusIndex","renovationStageIndex","onLoad","options","Number","ID","bootstrap","methods","toFullMediaUrl","url","test","startsWith","root","baseUrl","replace","path","goBack","navigateBack","ensurePermission","userStore","$store","getStorageSync","isLogin","reLaunch","ui","userInfo","can_manage_properties","getInfo","e","showModal","content","showCancel","success","onSaleStatusChange","detail","opt","onPriceUnitChange","loadFormOptions","loadContent","loadRenovation","cacheKey","business_id","cached","applyFormOptions","res","propertyApi","getFormOptions","code","setStorageSync","normalize","arr","sale","unit","floor","ori","pt","deco","stages","renovation_stage","fixValue","key","fallback","some","stageVal","onBuildYearChange","onFloorLevelChange","onOrientationChange","onPropertyTypeChange","onDecorationTypeChange","onAddressRegionChange","buildFullAddress","Boolean","initAddressUIFromAddress","raw","parts","split","slice","onRenovationStageChange","getManageContent","getManageRenovation","property_id","materials","addTag","t","includes","showToast","icon","removeTag","openImageActions","img","isCover","list","showActionSheet","itemList","tap","tapIndex","openVideoActions","has","async","pickVideo","onRenovationStatusChange","addMaterial","removeMaterial","openRenovationImageActions","pickRenovationImages","chooseImage","count","sizeType","sourceType","files","tempFilePaths","uploadFiles","pickImages","Promise","resolve","chooseVideo","maxDuration","compressed","filePath","tempFilePath","_a","fail","filePaths","filetype","target","showLoading","mask","fp","out","uploadSingle","catch","hideLoading","reject","token","timestamp","Math","now","header","Accept","Businessid","apiverify","md5","Authorization","uploadFile","name","formData","upRes","JSON","parse","message","err","pickLocation","chooseLocation","lat","lng","isFinite","save","payload","saveManage","createdNew","nid","renovationSaved","saveRenovation","silent","reload","progress","saveManageRenovation","preview","navigateTo","createPage","MiniProgramPage"],"mappings":"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"}