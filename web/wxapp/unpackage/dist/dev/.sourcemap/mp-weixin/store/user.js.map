{"version":3,"file":"user.js","sources":["store/user.js"],"sourcesContent":["import { defineStore } from 'pinia';\r\nimport userApi from '@/api/user';\r\nimport cloneDeep from 'lodash/cloneDeep';\r\n// 默认用户信息\r\nconst defaultUserInfo = {\n  avatar: '', // 头像\n  name: '', // 姓名\n  nickname: '', // 昵称\n  mobile: '', // 手机号\n  can_manage_properties: 0, // 是否可维护房源:0否,1是\n};\nconst user = defineStore({\r\n  id: 'user',\r\n  state: () => ({\r\n    userInfo: {...defaultUserInfo}, // 用户信息\r\n    isLogin: !!uni.getStorageSync('token'), // 登录状态\r\n  }),\r\n\r\n  actions: {\r\n    // 获取个人信息\r\n    async getInfo() {\r\n      const res = await userApi.getuserinfo();\r\n      if (!res || res.code !== 0) return;\r\n      this.userInfo = res.data;\r\n      return Promise.resolve(res.data);\r\n    },\r\n\t//更新用户信息\r\n    setUserInfo(info) {\r\n\t    this.userInfo =info\r\n\t},\r\n    // 设置token\r\n    setToken(token = '') {\r\n      if (token === '') {\r\n        this.isLogin = false;\r\n        uni.removeStorageSync('token');\r\n      } else {\r\n        this.isLogin = true;\r\n        uni.setStorageSync('token', token);\r\n      }\r\n      return this.isLogin;\r\n    },\r\n\r\n    // 重置用户默认数据\r\n    resetUserData() {\r\n      this.setToken();\r\n      this.userInfo = cloneDeep(defaultUserInfo);\r\n    },\r\n    // 登出\r\n    async logout(force = false) {\r\n      if (!force) {\r\n        const res = await userApi.logout();\r\n        if (res && res.code === 0) {\r\n          this.resetUserData();\r\n        }\r\n      }\r\n      if (force) {\r\n        this.resetUserData();\r\n      }\r\n\r\n      return !this.isLogin;\r\n    },\r\n  },\r\n});\r\n\r\nexport default user;\r\n"],"names":["defaultUserInfo","avatar","name","nickname","mobile","can_manage_properties","user","defineStore","id","state","userInfo","isLogin","uni","getStorageSync","actions","getInfo","res","userApi","getuserinfo","code","this","data","Promise","resolve","setUserInfo","info","setToken","token","removeStorageSync","setStorageSync","resetUserData","cloneDeep","logout","force"],"mappings":"gFAIMA,EAAkB,CACtBC,OAAQ,GACRC,KAAM,GACNC,SAAU,GACVC,OAAQ,GACRC,sBAAuB,GAEnBC,EAAOC,EAAAA,YAAY,CACvBC,GAAI,OACJC,MAAO,KAAO,CACZC,SAAU,IAAIV,GACdW,UAAWC,UAAIC,eAAe,WAGhCC,QAAS,CAEP,aAAMC,GACJ,MAAMC,QAAYC,UAAQC,cACtB,GAACF,GAAoB,IAAbA,EAAIG,KAET,OADPC,KAAKV,SAAWM,EAAIK,KACbC,QAAQC,QAAQP,EAAIK,KAC5B,EAED,WAAAG,CAAYC,GACXL,KAAKV,SAAUe,CAClB,EAEE,QAAAC,CAASC,EAAQ,IAQf,MAPc,KAAVA,GACFP,KAAKT,SAAU,YACXiB,kBAAkB,WAEtBR,KAAKT,SAAU,EACfC,EAAAA,QAAIiB,eAAe,QAASF,IAEvBP,KAAKT,OACb,EAGD,aAAAmB,GACEV,KAAKM,WACAN,KAAAV,SAAWqB,YAAU/B,EAC3B,EAED,YAAMgC,CAAOC,GAAQ,GACnB,IAAKA,EAAO,CACV,MAAMjB,QAAYC,UAAQe,SACtBhB,GAAoB,IAAbA,EAAIG,MACbC,KAAKU,eAER,CAKD,OAJIG,GACFb,KAAKU,iBAGCV,KAAKT,OACd"}