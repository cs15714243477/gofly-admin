{"version":3,"file":"user.js","sources":["store/user.js"],"sourcesContent":["import { defineStore } from 'pinia';\r\nimport userApi from '@/api/user';\r\nimport cloneDeep from 'lodash/cloneDeep';\r\n// 默认用户信息\r\nconst defaultUserInfo = {\r\n  avatar: '', // 头像\r\n  name: '', // 姓名\r\n  nickname: '', // 昵称\r\n  mobile: '', // 手机号\r\n};\r\nconst user = defineStore({\r\n  id: 'user',\r\n  state: () => ({\r\n    userInfo: {...defaultUserInfo}, // 用户信息\r\n    isLogin: !!uni.getStorageSync('token'), // 登录状态\r\n  }),\r\n\r\n  actions: {\r\n    // 获取个人信息\r\n    async getInfo() {\r\n      const res = await userApi.getuserinfo();\r\n      if (!res || res.code !== 0) return;\r\n      this.userInfo = res.data;\r\n      return Promise.resolve(res.data);\r\n    },\r\n\t//更新用户信息\r\n    setUserInfo(info) {\r\n\t    this.userInfo =info\r\n\t},\r\n    // 设置token\r\n    setToken(token = '') {\r\n      if (token === '') {\r\n        this.isLogin = false;\r\n        uni.removeStorageSync('token');\r\n      } else {\r\n        this.isLogin = true;\r\n        uni.setStorageSync('token', token);\r\n      }\r\n      return this.isLogin;\r\n    },\r\n\r\n    // 重置用户默认数据\r\n    resetUserData() {\r\n      this.setToken();\r\n      this.userInfo = cloneDeep(defaultUserInfo);\r\n    },\r\n    // 登出\r\n    async logout(force = false) {\r\n      if (!force) {\r\n        const res = await userApi.logout();\r\n        if (res && res.code === 0) {\r\n          this.resetUserData();\r\n        }\r\n      }\r\n      if (force) {\r\n        this.resetUserData();\r\n      }\r\n\r\n      return !this.isLogin;\r\n    },\r\n  },\r\n});\r\n\r\nexport default user;\r\n"],"names":["defineStore","uni","userApi","cloneDeep"],"mappings":";;;AAIA,MAAM,kBAAkB;AAAA,EACtB,QAAQ;AAAA;AAAA,EACR,MAAM;AAAA;AAAA,EACN,UAAU;AAAA;AAAA,EACV,QAAQ;AAAA;AACV;AACK,MAAC,OAAOA,cAAAA,YAAY;AAAA,EACvB,IAAI;AAAA,EACJ,OAAO,OAAO;AAAA,IACZ,UAAU,EAAC,GAAG,gBAAe;AAAA;AAAA,IAC7B,SAAS,CAAC,CAACC,sBAAI,eAAe,OAAO;AAAA;AAAA,EACzC;AAAA,EAEE,SAAS;AAAA;AAAA,IAEP,MAAM,UAAU;AACd,YAAM,MAAM,MAAMC,iBAAQ;AAC1B,UAAI,CAAC,OAAO,IAAI,SAAS;AAAG;AAC5B,WAAK,WAAW,IAAI;AACpB,aAAO,QAAQ,QAAQ,IAAI,IAAI;AAAA,IAChC;AAAA;AAAA,IAED,YAAY,MAAM;AACjB,WAAK,WAAU;AAAA,IAClB;AAAA;AAAA,IAEE,SAAS,QAAQ,IAAI;AACnB,UAAI,UAAU,IAAI;AAChB,aAAK,UAAU;AACfD,8BAAI,kBAAkB,OAAO;AAAA,MACrC,OAAa;AACL,aAAK,UAAU;AACfA,sBAAAA,QAAI,eAAe,SAAS,KAAK;AAAA,MAClC;AACD,aAAO,KAAK;AAAA,IACb;AAAA;AAAA,IAGD,gBAAgB;AACd,WAAK,SAAQ;AACb,WAAK,WAAWE,wBAAU,eAAe;AAAA,IAC1C;AAAA;AAAA,IAED,MAAM,OAAO,QAAQ,OAAO;AAC1B,UAAI,CAAC,OAAO;AACV,cAAM,MAAM,MAAMD,iBAAQ;AAC1B,YAAI,OAAO,IAAI,SAAS,GAAG;AACzB,eAAK,cAAa;AAAA,QACnB;AAAA,MACF;AACD,UAAI,OAAO;AACT,aAAK,cAAa;AAAA,MACnB;AAED,aAAO,CAAC,KAAK;AAAA,IACd;AAAA,EACF;AACH,CAAC;;"}