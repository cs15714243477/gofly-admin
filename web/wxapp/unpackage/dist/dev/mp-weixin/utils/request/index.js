"use strict";const e=require("../../common/vendor.js"),s=require("../config/index.js"),t=require("../../store/index.js");function r(s=""){const t=(e=>{const s=[];for(let t=0;t<e.length;t++){let r=e.charCodeAt(t);r<128?s.push(r):r<2048?(s.push(192|r>>6),s.push(128|63&r)):(s.push(224|r>>12),s.push(128|r>>6&63),s.push(128|63&r))}return new Uint8Array(s)})(s).buffer;return void 0!==e.wx$1&&e.wx$1.arrayBufferToBase64?e.wx$1.arrayBufferToBase64(t):void 0!==e.index$1&&e.index$1.arrayBufferToBase64?e.index$1.arrayBufferToBase64(t):""}let o={target:null,count:0};function a(){o.count>0&&o.count--,0===o.count&&e.index$1.hideLoading()}const i=new e.Request({baseURL:s.baseUrl+s.apiModel,timeout:8e3,method:"GET",custom:{showSuccess:!1,successMsg:"",showError:!0,errorMsg:"",showLoading:!0,loadingMsg:"加载中",auth:!1}});i.interceptors.request.use((s=>{const a=e.index$1.getStorageSync("token");if(a&&!t.$store("user").isLogin&&t.$store("user").setToken(a),s.custom.auth&&!a&&!t.$store("user").isLogin)return Promise.reject();s.custom.showLoading&&(o.count++,0===o.count&&e.index$1.showLoading({title:s.custom.loadingMsg,mask:!0,fail:()=>{e.index$1.hideLoading()}}));let i=Date.parse((new Date).toString())/1e3;let n={Accept:"text/json","Content-Type":"application/json;charset=UTF-8",Businessid:"1",apiverify:r(e.md5("gofly@888"+i)+"#"+i)};return a&&(n=Object.assign({},n,{Authorization:`${a}`})),s.header=n,s}),(e=>Promise.reject(e))),i.interceptors.response.use((s=>{if((s.header.authorization||s.header.Authorization)&&t.$store("user").setToken(s.header.authorization||s.header.Authorization),s.config.custom.showLoading&&a(),0!==s.data.code)return s.config.custom.showError&&e.index$1.showToast({title:s.data.message||"服务器开小差啦,请稍后再试~",icon:"none",mask:!0}),Promise.resolve(s.data);if(0!==s.data.code&&""!==s.data.message&&s.config.custom.showSuccess&&e.index$1.showToast({title:s.config.custom.successMsg||s.data.message,icon:"none"}),s.data&&s.data.token){t.$store("user").setToken(s.data.token)}return Promise.resolve(s.data)}),(s=>{var r;const o=t.$store("user"),i=o.isLogin;let n="网络请求出错";if(void 0!==s)switch(s.statusCode){case 400:n="请求错误";break;case 401:n=i?"您的登陆已过期":"请先登录",o.logout(!0);break;case 403:n="拒绝访问";break;case 404:n="请求出错";break;case 408:n="请求超时";break;case 429:n="请求频繁, 请稍后再访问";break;case 500:n="服务器开小差啦,请稍后再试~";break;case 501:n="服务未实现";break;case 502:n="网络错误";break;case 503:n="服务不可用";break;case 504:n="网络超时";break;case 505:n="HTTP版本不受支持"}return s&&s.config&&(!1===s.config.custom.showError&&e.index$1.showToast({title:(null==(r=s.data)?void 0:r.message)||n,icon:"none",mask:!0}),s.config.custom.showLoading&&a()),!1}));exports.request=e=>{if(e&&"string"==typeof e.url){const t=e.url,r=s.apiModel,o=s.apiPath;r.startsWith("/")&&t.startsWith(r+"/")&&(e.url=t.slice(r.length)),o.startsWith("/")&&e.url.startsWith(o+"/")&&(e.url=e.url.slice(o.length)),e.url.startsWith("/business/business/")&&(e.url=e.url.replace("/business/business/","/business/")),e.url.startsWith("/uniapp/uniapp/")&&(e.url=e.url.replace("/uniapp/uniapp/","/uniapp/"))}return!s.apiModel.includes("/business")&&!s.apiPath.startsWith("/business")&&"string"==typeof e.url&&e.url.startsWith("/")&&!e.url.startsWith("/business/")&&(e.url="/business"+e.url),"/"!==e.url[0]&&(e.url=s.apiPath+e.url),i.middleware(e)};
//# sourceMappingURL=../../../.sourcemap/mp-weixin/utils/request/index.js.map
