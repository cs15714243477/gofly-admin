"use strict";const o=require("../../common/vendor.js"),t=require("../../api/ttlock.js"),e={components:{TopHeader:()=>"../../components/TopHeader.js"},data:()=>({propertyId:0,unlocking:!1}),onLoad(o){const t=Number(o&&(o.property_id||o.id)||0);this.propertyId=Number.isFinite(t)?t:0},methods:{goBack(){o.index$1.navigateBack()},async bluetoothUnlock(){if(this.unlocking)return;if(!this.propertyId)return void o.index$1.showToast({title:"缺少房源ID，无法开锁",icon:"none"});this.unlocking=!0;let e=null;try{e=requirePlugin("ttlock-plugin")}catch(n){}if(!e||"function"!=typeof e.controlLock)return this.unlocking=!1,void o.index$1.showToast({title:"未检测到通通锁插件，请检查小程序插件配置",icon:"none"});try{const n=await t.ttlockApi.getPropertyBleInfo({property_id:this.propertyId});if(!n||0!==n.code)return;const i=n.data||{},r=String(i.key_data||i.lock_data||"").trim();if(!r)return void o.index$1.showToast({title:"缺少开锁数据，请先同步钥匙信息",icon:"none"});o.index$1.showLoading({title:"蓝牙开锁中",mask:!0});const c=await e.controlLock({controlAction:3,lockData:r,serverTime:Date.now()});if(o.index$1.hideLoading(),c&&0===Number(c.errorCode))return void o.index$1.showToast({title:"开锁成功",icon:"success"});const s=c&&(c.errorMsg||c.errMsg||c.description)||"开锁失败，请重试";o.index$1.showToast({title:s,icon:"none"})}catch(n){try{o.index$1.hideLoading()}catch(i){}o.index$1.showToast({title:n&&n.message?n.message:"开锁失败，请稍后重试",icon:"none"})}finally{try{e&&"function"==typeof e.stopAllOperations&&await e.stopAllOperations()}catch(n){}this.unlocking=!1}},passwordUnlock(){o.index$1.navigateTo({url:`/pages/unlock_details/unlock_details?property_id=${encodeURIComponent(this.propertyId)}`})}}};if(!Array){o.resolveComponent("TopHeader")()}const n=o._export_sfc(e,[["render",function(t,e,n,i,r,c){return{a:o.o(((...o)=>c.goBack&&c.goBack(...o))),b:o.p({title:"开锁步骤"}),c:o.o(((...o)=>c.bluetoothUnlock&&c.bluetoothUnlock(...o))),d:o.o(((...o)=>c.passwordUnlock&&c.passwordUnlock(...o)))}}]]);wx.createPage(n);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/unlock_steps/unlock_steps.js.map
