"use strict";const e=require("../../common/vendor.js"),t=require("../../api/user.js");const n={components:{TopHeader:()=>"../../components/TopHeader.js"},data:()=>({loading:!0,agent:{},agentId:0,styleIndex:0,systemRecommendedProperties:[],agentRecommendedProperties:[],styles:[{bg:"linear-gradient(135deg, #2d9cf0, #1e40af)",decor2:"rgba(249, 115, 22, 0.2)",badge:"PRO",badgeBg:"#f97316"},{bg:"linear-gradient(135deg, #06b6d4, #2563eb)",decor2:"rgba(255, 255, 255, 0.12)",badge:"TOP",badgeBg:"#22c55e"},{bg:"linear-gradient(135deg, #111827, #334155)",decor2:"rgba(45, 156, 240, 0.18)",badge:"VIP",badgeBg:"#2d9cf0"}]}),computed:{currentStyle(){return this.styles[this.styleIndex]||this.styles[0]}},onLoad(e){const t=e&&e.scene?decodeURIComponent(e.scene):"",n=Number(e.agent_id||0),a=function(e=""){const t=String(e||"").trim();if(t.includes("=")&&t.includes("&")){const e={};return t.split("&").forEach((t=>{const[n,a]=t.split("=");n&&(e[n]=a)})),{agentId:Number(e.a||e.agent_id||0),style:Number(e.s||0)}}const n=t.match(/a(\d+)_s(\d+)/);if(n)return{agentId:Number(n[1]||0),style:Number(n[2]||0)};const a=t.match(/a(\d+)/);return a?{agentId:Number(a[1]||0),style:0}:{agentId:0,style:0}}(t);this.styleIndex=Math.max(0,Number(e.style||a.style||0)),this.agentId=n||a.agentId,this.fetchAgent(this.agentId)},methods:{safeImage(e){const t=String(e||"").trim();return t?0===t.indexOf("/static/images/")?"":t:""},formatPropertyMeta(e){const t=e&&e.area?`${e.area}㎡`:"",n=Number(e&&e.rooms)||0,a=Number(e&&e.halls)||0,r=Number(e&&e.bathrooms)||0;let o="";(n||a||r)&&(o=`${n}室${a}厅${r}卫`);return[String(e&&e.community_name||"").trim(),o,t].filter(Boolean).join(" · ")||"基础信息"},async fetchAgent(e){this.loading=!0;try{if(!e)return this.agent={},this.systemRecommendedProperties=[],void(this.agentRecommendedProperties=[]);const n=await t.userApi.getAgentCard({agent_id:e},!0);if(!n||0!==n.code)return this.agent={},this.systemRecommendedProperties=[],void(this.agentRecommendedProperties=[]);const a=n.data||{};this.agent=a,this.systemRecommendedProperties=Array.isArray(a.system_recommended_properties)?a.system_recommended_properties:[],this.agentRecommendedProperties=Array.isArray(a.agent_recommended_properties)?a.agent_recommended_properties:[]}finally{this.loading=!1}},openProperty(t){const n=Number(t&&(t.id||t.ID))||0;if(!n)return;const a=Number(this.agentId||this.agent&&this.agent.id||0),r=Number(this.styleIndex||0);e.index$1.navigateTo({url:`/pages/property_detail/property_detail?id=${encodeURIComponent(n)}&public=1&from_agent_id=${encodeURIComponent(a)}&from_style=${encodeURIComponent(r)}`})},callAgent(){const t=String(this.agent&&this.agent.mobile||"").trim();t&&e.index$1.makePhoneCall({phoneNumber:t})},copyMobile(){const t=String(this.agent&&this.agent.mobile||"").trim();t&&e.index$1.setClipboardData({data:t,success:()=>e.index$1.showToast({title:"已复制",icon:"none"})})}}};if(!Array){e.resolveComponent("TopHeader")()}const a=e._export_sfc(n,[["render",function(t,n,a,r,o,i){return e.e({a:e.p({title:"经纪人名片"}),b:i.currentStyle.decor2,c:e.t(o.agent.store_name||"未绑定门店"),d:e.t(i.currentStyle.badge),e:i.currentStyle.badgeBg,f:i.safeImage(o.agent.avatar)},i.safeImage(o.agent.avatar)?{g:i.safeImage(o.agent.avatar)}:{},{h:e.t(o.agent.name||"-"),i:e.t(o.agent.title||"置业顾问"),j:o.agent.store_address},o.agent.store_address?{k:e.t(o.agent.store_address)}:{},{l:o.agent.introduction},o.agent.introduction?{m:e.t(o.agent.introduction)}:{},{n:e.o(((...e)=>i.callAgent&&i.callAgent(...e))),o:!o.agent.mobile,p:e.o(((...e)=>i.copyMobile&&i.copyMobile(...e))),q:!o.agent.mobile,r:i.currentStyle.bg,s:o.loading},(o.loading||o.loading||o.agent.id,{}),{t:!o.loading&&!o.agent.id,v:!o.loading&&o.agent.id},!o.loading&&o.agent.id?e.e({w:0===o.agentRecommendedProperties.length},0===o.agentRecommendedProperties.length?{}:{x:e.f(o.agentRecommendedProperties,((t,n,a)=>e.e({a:i.safeImage(t.image||t.cover_image)},i.safeImage(t.image||t.cover_image)?{b:i.safeImage(t.image||t.cover_image)}:{},{c:e.t(t.title||"-"),d:e.t(t.price||"-"),e:e.t(t.price_unit||""),f:e.t(i.formatPropertyMeta(t)),g:"agent-"+t.id,h:e.o((e=>i.openProperty(t)),"agent-"+t.id)})))},{y:0===o.systemRecommendedProperties.length},0===o.systemRecommendedProperties.length?{}:{z:e.f(o.systemRecommendedProperties,((t,n,a)=>e.e({a:i.safeImage(t.image||t.cover_image)},i.safeImage(t.image||t.cover_image)?{b:i.safeImage(t.image||t.cover_image)}:{},{c:e.t(t.title||"-"),d:e.t(t.price||"-"),e:e.t(t.price_unit||""),f:e.t(i.formatPropertyMeta(t)),g:"sys-"+t.id,h:e.o((e=>i.openProperty(t)),"sys-"+t.id)})))}):{})}]]);wx.createPage(a);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/agent_public_card/agent_public_card.js.map
