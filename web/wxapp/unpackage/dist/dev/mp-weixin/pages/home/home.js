"use strict";const e=require("../../common/vendor.js"),t=require("../../api/home.js"),i={components:{BottomTabBar:()=>"../../components/BottomTabBar.js",TopHeader:()=>"../../components/TopHeader.js"},onLoad(){const t=e.index$1.getStorageSync("hm_province_name");this.provinceName=t||"辽宁",e.index$1.getLocation({type:"wgs84",success:()=>{},fail:()=>{this.provinceName=this.provinceName||"辽宁"}}),this.loadHomeData()},data:()=>({provinceName:"辽宁",provinceOptions:["辽宁","北京","上海","广东","浙江","江苏"],keyword:"",locationOpen:!1,locationCities:[{key:"shenyang",label:"沈阳",districts:[{key:"heping",label:"和平区"},{key:"shenhe",label:"沈河区"},{key:"huanggu",label:"皇姑区"},{key:"tiexi",label:"铁西区"}]},{key:"dalian",label:"大连",districts:[{key:"zhongshan",label:"中山区"},{key:"xigang",label:"西岗区"},{key:"shahekou",label:"沙河口区"},{key:"ganjingzi",label:"甘井子区"}]},{key:"anshan",label:"鞍山",districts:[{key:"tiedong",label:"铁东区"},{key:"tiexi",label:"铁西区"},{key:"lixian",label:"立山区"}]}],locDraft:{city:"",district:""},filters:{location:"",filter:"",sort:"",more:[]},panelOpen:!1,panelType:"",panelDraft:{location:"",filter:"",sort:"",more:[]},filterOptions:{filter:[{value:"",label:"筛选"},{value:"smart_lock",label:"智能锁"},{value:"near_subway",label:"近地铁"},{value:"new",label:"新上"},{value:"price_drop",label:"降价"}],sort:[{value:"",label:"排序"},{value:"recommend",label:"推荐优先"},{value:"price_asc",label:"价格从低到高"},{value:"price_desc",label:"价格从高到低"},{value:"latest",label:"最新发布"}],more:[{value:"whole_rent",label:"整租"},{value:"shared",label:"合租"},{value:"elevator",label:"有电梯"},{value:"south",label:"朝南"},{value:"pet",label:"可养宠"}]},bannerImages:["/static/images/img_28f6b412d7.png","/static/images/img_2abd9934e1.png","/static/images/img_48afe8538f.png"],followedTotal:0,followedProperties:[{name:"阳光花园 · 2室1厅",area:"朝阳区",size:"85",price:"6,500",type:"住宅",priceChange:"降价 ¥200",image:"/static/images/img_48afe8538f.png"},{name:"金域华府 A2",area:"东城区",size:"65",price:"5,800",status:"待看",image:"/static/images/img_cd1f0409ce.png"}],recommendedProperties:[{name:"远洋万和城 · 3室2厅",price:"9,200",region:"海淀区",size:"120",desc:"近公园",status:"急租",tags:["近地铁","新上"],image:"/static/images/img_28f6b412d7.png"},{name:"柳溪公寓 · 开间",price:"4,100",region:"丰台区",size:"45",desc:"西向",tags:["随时入住","免中介费"],image:"/static/images/img_f7b0d6455a.png"}]}),computed:{filterLabelLocation(){if(!this.filters.location)return"市/区";const[e,t]=String(this.filters.location).split("|"),i=this.locationCities.find((t=>t.key===e));if(!i)return"市/区";const a=(i.districts||[]).find((e=>e.key===t));return a?`${i.label} · ${a.label}`:i.label},currentDistricts(){const e=this.locationCities.find((e=>e.key===this.locDraft.city))||this.locationCities[0];return e&&e.districts||[]},filterLabelFilter(){const e=this.filterOptions.filter.find((e=>e.value===this.filters.filter));return e?e.label:"筛选"},filterLabelSort(){const e=this.filterOptions.sort.find((e=>e.value===this.filters.sort));return e?e.label:"排序"},filterLabelMore(){return this.filters.more&&0!==this.filters.more.length?`更多(${this.filters.more.length})`:"更多"},panelTitle(){return"location"===this.panelType?"选择位置":"filter"===this.panelType?"选择筛选":"sort"===this.panelType?"选择排序":"more"===this.panelType?"更多条件":""},panelOptions(){return this.filterOptions&&this.filterOptions[this.panelType]||[]}},methods:{async loadHomeData(){let i;try{i=await t.homeApi.Homedata({keyword:this.keyword||"",location:this.filters.location||"",filter:this.filters.filter||"",sort:this.filters.sort||"",more:Array.isArray(this.filters.more)?this.filters.more:[]})}catch(o){return void(e.index$1.getStorageSync("token")||e.index$1.reLaunch({url:"/pages/login/login"}))}if(!i||0!==i.code)return;const a=i.data||{};Array.isArray(a.bannerImages)&&(this.bannerImages=a.bannerImages),"number"==typeof a.followedTotal&&(this.followedTotal=a.followedTotal),Array.isArray(a.followedProperties)&&(this.followedProperties=a.followedProperties),Array.isArray(a.recommendedProperties)&&(this.recommendedProperties=a.recommendedProperties)},onSearchConfirm(){this.loadHomeData()},selectProvince(){e.index$1.showActionSheet({itemList:this.provinceOptions,success:t=>{const i=this.provinceOptions[t.tapIndex];i&&(this.provinceName=i,e.index$1.setStorageSync("hm_province_name",i),this.loadHomeData())}})},openLocationPicker(){this.locationOpen=!0;const[e,t]=String(this.filters.location||"").split("|");if(this.locDraft.city=e||this.locationCities[0]&&this.locationCities[0].key||"",this.locDraft.district=t||"",!this.locDraft.district){const e=this.locationCities.find((e=>e.key===this.locDraft.city))||this.locationCities[0],t=e&&e.districts&&e.districts[0];this.locDraft.district=t&&t.key||""}},closeLocationPicker(){this.locationOpen=!1},resetLocationPicker(){const e=this.locationCities[0];this.locDraft.city=e&&e.key||"",this.locDraft.district=e&&e.districts&&e.districts[0]&&e.districts[0].key||""},selectLocCity(e){this.locDraft.city=e;const t=this.locationCities.find((t=>t.key===e))||this.locationCities[0],i=t&&t.districts&&t.districts[0];this.locDraft.district=i&&i.key||""},applyLocationPicker(){this.locDraft.city?this.filters.location=`${this.locDraft.city}|${this.locDraft.district||""}`:this.filters.location="",this.closeLocationPicker(),this.loadHomeData()},openPanel(e){this.panelType=e,this.panelOpen=!0,this.panelDraft={location:this.filters.location,filter:this.filters.filter,sort:this.filters.sort,more:Array.isArray(this.filters.more)?[...this.filters.more]:[]}},closePanel(){this.panelOpen=!1,this.panelType=""},resetPanel(){"location"===this.panelType&&(this.panelDraft.location=""),"filter"===this.panelType&&(this.panelDraft.filter=""),"sort"===this.panelType&&(this.panelDraft.sort=""),"more"===this.panelType&&(this.panelDraft.more=[])},applyPanel(){this.filters={location:this.panelDraft.location,filter:this.panelDraft.filter,sort:this.panelDraft.sort,more:Array.isArray(this.panelDraft.more)?[...this.panelDraft.more]:[]},this.closePanel(),this.loadHomeData()},isOptionActive(e){return!!e&&("location"===this.panelType?this.panelDraft.location===e.value:"filter"===this.panelType?this.panelDraft.filter===e.value:"sort"===this.panelType&&this.panelDraft.sort===e.value)},selectSingle(e){e&&("location"===this.panelType&&(this.panelDraft.location=e.value),"filter"===this.panelType&&(this.panelDraft.filter=e.value),"sort"===this.panelType&&(this.panelDraft.sort=e.value))},isMoreSelected(e){return!!e&&(this.panelDraft.more||[]).includes(e.value)},toggleMore(e){if(!e)return;const t=Array.isArray(this.panelDraft.more)?this.panelDraft.more:[],i=t.indexOf(e.value);i>=0?t.splice(i,1):t.push(e.value),this.panelDraft.more=t},selectCity(){e.index$1.__f__("log","at pages/home/home.vue:702","选择城市")},viewAllFollowed(){e.index$1.navigateTo({url:"/pages/property_list/property_list"})},goToDetail(t){const i=t&&t.id?t.id:"";e.index$1.navigateTo({url:i?`/pages/property_detail/property_detail?id=${i}`:"/pages/property_detail/property_detail"})},ensureTags:e=>e?Array.isArray(e)?e.filter((e=>!!e)):"string"==typeof e?e.split(",").map((e=>e.trim())).filter((e=>!!e)):[]:[],getPriceUnit:e=>(e&&e.price_unit?String(e.price_unit):"万")||"万",getSaleStatusLabel:e=>({on_sale:"在售",sold:"已售",off_market:"下架"}[e]||""),getSaleStatusClass:e=>({on_sale:"badge-success",sold:"badge-default",off_market:"badge-warning"}[e]||"badge-default"),isSoldOrOff:e=>"sold"===e||"off_market"===e,getLayoutText(e){if(!e)return"";const t=Number(e.rooms||0),i=Number(e.halls||0),a=Number(e.bathrooms||0);return t>0||i>0||a>0?`${t}室${i}厅${a}卫`:""},formatFollowedMeta(e){const t=[],i=e&&(e.community_name||e.area)?String(e.community_name||e.area):"";i&&t.push(i);const a=this.getLayoutText(e);a&&t.push(a);const o=e&&e.size?`${e.size}㎡`:"";return o&&t.push(o),t.join(" · ")},formatRecommendedMeta(e){const t=[],i=e&&(e.region||e.community_name)?String(e.region||e.community_name):"";i&&t.push(i);const a=this.getLayoutText(e);a&&t.push(a);const o=e&&e.size?`${e.size}㎡`:"";o&&t.push(o);const l=e&&(e.property_type||e.desc)?String(e.property_type||e.desc):"";return l&&t.push(l),t.join(" · ")}}};if(!Array){(e.resolveComponent("TopHeader")+e.resolveComponent("BottomTabBar"))()}const a=e._export_sfc(i,[["render",function(t,i,a,o,l,s){return e.e({a:e.p({title:"推荐"}),b:e.t(l.provinceName),c:e.o(((...e)=>s.selectProvince&&s.selectProvince(...e))),d:e.o(((...e)=>s.onSearchConfirm&&s.onSearchConfirm(...e))),e:l.keyword,f:e.o((e=>l.keyword=e.detail.value)),g:l.filters.more.length>0},(l.filters.more.length,{}),{h:l.filters.more.length>0?1:"",i:e.o((e=>s.openPanel("more"))),j:e.f(l.bannerImages,((e,t,i)=>({a:e,b:t}))),k:e.t(s.filterLabelLocation),l:l.filters.location?1:"",m:e.o(((...e)=>s.openLocationPicker&&s.openLocationPicker(...e))),n:e.t(s.filterLabelFilter),o:l.filters.filter?1:"",p:e.o((e=>s.openPanel("filter"))),q:e.t(s.filterLabelSort),r:l.filters.sort?1:"",s:e.o((e=>s.openPanel("sort"))),t:e.t(l.followedTotal),v:e.o(((...e)=>s.viewAllFollowed&&s.viewAllFollowed(...e))),w:!l.followedProperties||0===l.followedProperties.length},l.followedProperties&&0!==l.followedProperties.length?{y:e.f(l.followedProperties,((t,i,a)=>e.e({a:e.t(t.property_type||t.type),b:t.priceChange},t.priceChange?{c:e.t(t.priceChange)}:{},{d:s.getSaleStatusLabel(t.sale_status)},s.getSaleStatusLabel(t.sale_status)?{e:e.t(s.getSaleStatusLabel(t.sale_status)),f:e.n(s.getSaleStatusClass(t.sale_status))}:{},{g:1===Number(t.has_smart_lock)},(Number(t.has_smart_lock),{}),{h:s.isSoldOrOff(t.sale_status)?1:"",i:"url("+t.image+")",j:e.t(t.name),k:s.ensureTags(t.tags).length},s.ensureTags(t.tags).length?{l:e.f(s.ensureTags(t.tags).slice(0,2),((t,i,a)=>({a:e.t(t),b:i})))}:{},{m:e.t(s.formatFollowedMeta(t)),n:e.t(t.price),o:e.t(s.getPriceUnit(t)),p:i,q:e.o((e=>s.goToDetail(t)),i)})))}:{x:e.o(((...e)=>s.viewAllFollowed&&s.viewAllFollowed(...e)))},{z:e.f(l.recommendedProperties,((t,i,a)=>e.e({a:s.getSaleStatusLabel(t.sale_status)},s.getSaleStatusLabel(t.sale_status)?{b:e.t(s.getSaleStatusLabel(t.sale_status)),c:e.n(s.getSaleStatusClass(t.sale_status))}:{},{d:1===Number(t.has_smart_lock)},(Number(t.has_smart_lock),{}),{e:s.isSoldOrOff(t.sale_status)?1:"",f:"url("+t.image+")",g:e.t(t.name),h:e.t(t.price),i:e.t(s.getPriceUnit(t)),j:e.t(s.formatRecommendedMeta(t)),k:e.f(s.ensureTags(t.tags),((t,i,a)=>({a:e.t(t),b:i,c:"新上"===t?1:""}))),l:i,m:e.o((e=>s.goToDetail(t)),i)}))),A:e.p({active:"home"}),B:l.panelOpen},l.panelOpen?e.e({C:e.t(s.panelTitle),D:e.o(((...e)=>s.resetPanel&&s.resetPanel(...e))),E:"more"!==l.panelType},"more"!==l.panelType?{F:e.f(s.panelOptions,((t,i,a)=>e.e({a:e.t(t.label),b:s.isOptionActive(t)},(s.isOptionActive(t),{}),{c:i,d:s.isOptionActive(t)?1:"",e:e.o((e=>s.selectSingle(t)),i)})))}:{G:e.f(s.panelOptions,((t,i,a)=>e.e({a:e.t(t.label),b:s.isMoreSelected(t)},(s.isMoreSelected(t),{}),{c:i,d:s.isMoreSelected(t)?1:"",e:e.o((e=>s.toggleMore(t)),i)})))},{H:e.o(((...e)=>s.closePanel&&s.closePanel(...e))),I:e.o(((...e)=>s.applyPanel&&s.applyPanel(...e))),J:e.o((()=>{})),K:e.o(((...e)=>s.closePanel&&s.closePanel(...e)))}):{},{L:l.locationOpen},l.locationOpen?{M:e.o(((...e)=>s.resetLocationPicker&&s.resetLocationPicker(...e))),N:e.f(l.locationCities,((t,i,a)=>({a:e.t(t.label),b:t.key,c:l.locDraft.city===t.key?1:"",d:e.o((e=>s.selectLocCity(t.key)),t.key)}))),O:e.f(s.currentDistricts,((t,i,a)=>({a:e.t(t.label),b:t.key,c:l.locDraft.district===t.key?1:"",d:e.o((e=>l.locDraft.district=t.key),t.key)}))),P:e.o(((...e)=>s.closeLocationPicker&&s.closeLocationPicker(...e))),Q:e.o(((...e)=>s.applyLocationPicker&&s.applyLocationPicker(...e))),R:e.o((()=>{})),S:e.o(((...e)=>s.closeLocationPicker&&s.closeLocationPicker(...e)))}:{})}]]);wx.createPage(a);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/home/home.js.map
