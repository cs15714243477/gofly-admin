"use strict";const e=require("../../common/vendor.js"),t=require("../../api/home.js"),o={components:{BottomTabBar:()=>"../../components/BottomTabBar.js",TopHeader:()=>"../../components/TopHeader.js"},onLoad(){this.loadHomeData()},onShow(){this.loadHomeData()},onPullDownRefresh(){this.loadHomeData().finally((()=>{e.index$1.stopPullDownRefresh()}))},data:()=>({loading:!1,bannerImages:[],followedTotal:0,followedProperties:[],recommendedProperties:[]}),methods:{async loadHomeData(){if(this.loading)return!1;let o;this.loading=!0;try{o=await t.homeApi.Homedata({page:1,pageSize:6})}catch(s){return this.loading=!1,e.index$1.getStorageSync("token")||e.index$1.reLaunch({url:"/pages/login/login"}),!1}if(this.loading=!1,!o||0!==o.code)return!1;const a=o.data||{};return this.bannerImages=Array.isArray(a.bannerImages)?a.bannerImages:[],this.followedTotal=Number(a.followedTotal||0),this.followedProperties=Array.isArray(a.followedProperties)?a.followedProperties:[],this.recommendedProperties=Array.isArray(a.recommendedProperties)?a.recommendedProperties:[],!0},goToList(){e.index$1.navigateTo({url:"/pages/property_list/property_list"})},goToDetail(t){const o=t&&(t.id||t.ID);o?e.index$1.navigateTo({url:`/pages/property_detail/property_detail?id=${encodeURIComponent(o)}`}):e.index$1.showToast({title:"房源ID缺失",icon:"none"})},safeImage:e=>String(e||"").trim()||"/static/images/img_28f6b412d7.png",ensureTags:e=>e?Array.isArray(e)?e.map((e=>e?"string"==typeof e?e.trim():"object"==typeof e?String(e.name||e.label||"").trim():String(e).trim():"")).filter(Boolean):"string"==typeof e?e.split(",").map((e=>e.trim())).filter(Boolean):[]:[],isSoldOrOff:e=>"sold"===e||"off_market"===e,saleStatusClass:e=>({on_sale:"badge-success",sold:"badge-default",off_market:"badge-warning"}[e]||"badge-default"),getLayoutText(e){if(!e)return"";const t=Number(e.rooms||0),o=Number(e.halls||0),a=Number(e.bathrooms||0);return t>0||o>0||a>0?`${t}室${o}厅${a}卫`:""},formatFollowedMeta(e){const t=[],o=e&&(e.community_name||e.area)?String(e.community_name||e.area):"";o&&t.push(o);const a=this.getLayoutText(e);a&&t.push(a);const s=e&&e.size?`${e.size}㎡`:"";return s&&t.push(s),t.join(" · ")},formatRecommendedMeta(e){const t=[],o=e&&(e.region||e.community_name)?String(e.region||e.community_name):"";o&&t.push(o);const a=this.getLayoutText(e);a&&t.push(a);const s=e&&e.size?`${e.size}㎡`:"";s&&t.push(s);const r=e&&(e.property_type||e.desc)?String(e.property_type||e.desc):"";return r&&t.push(r),t.join(" · ")}}};if(!Array){(e.resolveComponent("TopHeader")+e.resolveComponent("BottomTabBar"))()}const a=e._export_sfc(o,[["render",function(t,o,a,s,r,i){return e.e({a:e.p({title:"首页"}),b:e.f(r.bannerImages,((e,t,o)=>({a:e,b:t}))),c:e.o(((...e)=>i.goToList&&i.goToList(...e))),d:e.t(r.followedTotal||0),e:e.o(((...e)=>i.goToList&&i.goToList(...e))),f:!r.followedProperties||0===r.followedProperties.length},r.followedProperties&&0!==r.followedProperties.length?{h:e.f(r.followedProperties,((t,o,a)=>e.e({a:i.safeImage(t.image),b:t.sale_status_label},t.sale_status_label?{c:e.t(t.sale_status_label),d:e.n(i.saleStatusClass(t.sale_status))}:{},{e:1===Number(t.has_smart_lock)},(Number(t.has_smart_lock),{}),{f:i.isSoldOrOff(t.sale_status)?1:"",g:e.t(t.name||"-"),h:e.t(i.formatFollowedMeta(t)),i:e.t(t.price||"-"),j:e.t(t.price_unit||""),k:t.id||o,l:e.o((e=>i.goToDetail(t)),t.id||o)})))}:{g:e.o(((...e)=>i.goToList&&i.goToList(...e)))},{i:e.o(((...e)=>i.goToList&&i.goToList(...e))),j:r.loading&&0===r.recommendedProperties.length},r.loading&&0===r.recommendedProperties.length?{}:r.loading||0!==r.recommendedProperties.length?{m:e.f(r.recommendedProperties,((t,o,a)=>e.e({a:i.safeImage(t.image),b:t.sale_status_label},t.sale_status_label?{c:e.t(t.sale_status_label),d:e.n(i.saleStatusClass(t.sale_status))}:{},{e:1===Number(t.has_smart_lock)},(Number(t.has_smart_lock),{}),{f:i.isSoldOrOff(t.sale_status)?1:"",g:e.t(t.name||"-"),h:e.t(t.price||"-"),i:e.t(t.price_unit||""),j:e.t(i.formatRecommendedMeta(t)),k:i.ensureTags(t.tags).length>0},i.ensureTags(t.tags).length>0?{l:e.f(i.ensureTags(t.tags).slice(0,4),((t,o,a)=>({a:e.t(t),b:o})))}:{},{m:t.id||o,n:e.o((e=>i.goToDetail(t)),t.id||o)})))}:{l:e.o(((...e)=>i.goToList&&i.goToList(...e)))},{k:!r.loading&&0===r.recommendedProperties.length,n:e.p({active:"home"})})}]]);wx.createPage(a);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/home/home.js.map
