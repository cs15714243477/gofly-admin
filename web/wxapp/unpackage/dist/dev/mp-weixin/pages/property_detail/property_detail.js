"use strict";const e=require("../../common/vendor.js"),t=require("../../api/property.js"),r=require("../../common/assets.js"),o={data:()=>({propertyId:0,loading:!1,property:{},statusBarHeight:0,headerTop:0,headerOpacity:0,currentSwiper:0,isFollowed:!1,hasSmartLock:!1,ownerPhone:"",images:["/static/images/img_cdc09ae543.png","/static/images/img_cdc09ae543.png"],attributes:[{label:"单价",value:"9,086元/m²"},{label:"楼层",value:"中层 / 共32层"},{label:"朝向",value:"南北通透"},{label:"装修",value:"精装修"},{label:"年代",value:"2019年建"},{label:"产权",value:"商品房"}],renovationTabs:[{key:"none",label:"未装修"},{key:"in_progress",label:"进行中"},{key:"done",label:"已完成"}],renovation:{status:"in_progress",subtitle:"高端精装，环保材料（示例）",progress:68,stage:"水电验收完成，正在进行泥木施工",eta:"预计 2026-02-20",finishAt:"2026-01-10",materials:["圣象地板","马可波罗瓷砖","多乐士乳胶漆"],note:"客厅墙面已完成找平与底漆，卫生间防水已做闭水试验；全屋线管/强弱电分离施工完成。",images:["/static/images/img_08b712f810.png","/static/images/img_8642388cea.png"]},recommends:[{name:"阳光花园三期 2室",rooms:"2室1厅",price:"72万",size:"89",image:"/static/images/img_71f4809787.png"},{name:"金地名津 精装大三房",rooms:"3室2厅",price:"98万",size:"96",image:"/static/images/img_1112597ba0.png"},{name:"万科四季花城",rooms:"3室2厅",price:"105万",size:"110",image:"/static/images/img_662c3c598a.png"}]}),onLoad(t){const r=e.index$1.getSystemInfoSync();this.statusBarHeight=r.statusBarHeight;try{if(void 0!==e.wx$1&&e.wx$1.getMenuButtonBoundingClientRect){const t=e.wx$1.getMenuButtonBoundingClientRect(),o=Number(r.windowWidth||375),i=80*(o/750),a=Number(t.top||0)+Number(t.height||0)/2-i/2;this.headerTop=Math.max(Number(this.statusBarHeight||0),Math.round(a))}else this.headerTop=this.statusBarHeight+12}catch(i){this.headerTop=this.statusBarHeight+12}const o=Number(t&&(t.id||t.ID||t.property_id))||0;this.propertyId=o,this.propertyId?this.loadDetail():e.index$1.showToast({title:"房源ID缺失",icon:"none"})},methods:{tagClass(e){const t=String(e||"").trim();return t&&(t.includes("急售")||t.includes("降价"))?"orange":""},getLayoutText(e){const t=Number(e&&e.rooms)||0,r=Number(e&&e.halls)||0,o=Number(e&&e.bathrooms)||0;if(!t&&!r&&!o)return"-";let i="";return t&&(i+=`${t}室`),r&&(i+=`${r}厅`),o&&(i+=`${o}卫`),i||"-"},getUnitPriceText(e){const t=Number(e&&e.price),r=Number(e&&e.area);if(!t||!r)return"-";let o=t;"万"===(e&&e.price_unit||"")&&(o=1e4*t);const i=o/r;return i&&isFinite(i)?`${Math.round(i).toLocaleString()}元/㎡`:"-"},buildAttributes(e){const t=[];t.push({label:"单价",value:this.getUnitPriceText(e)});const r=String(e&&e.floor_level||"").trim(),o=Number(e&&e.total_floors)||0;(r||o)&&t.push({label:"楼层",value:`${r||"-"}${o?` / 共${o}层`:""}`}),t.push({label:"朝向",value:e&&e.orientation?e.orientation:"-"}),t.push({label:"装修",value:e&&e.decoration_type?e.decoration_type:"-"});const i=Number(e&&e.build_year)||0;return t.push({label:"年代",value:i?`${i}年建`:"-"}),t.push({label:"物业类型",value:e&&e.property_type?e.property_type:"-"}),t},getCommissionText(e){const t=String(e&&e.commission_rate||"").trim(),r=String(e&&e.commission_reward||"").trim(),o=!!t&&"0"!==t&&"0.0"!==t&&"0.00"!==t,i=!!r&&"0"!==r&&"0.0"!==r&&"0.00"!==r;return o&&i?`佣金${t}% ，成交奖励￥${r}`:o?`佣金${t}%`:i?`成交奖励￥${r}`:"佣金待定"},mapPinText(){const e=String(this.property&&this.property.community_name||"").trim(),t=String(this.property&&this.property.address||"").trim();return e&&t?`${e} · ${t}`:e||t||"暂无位置信息"},async loadDetail(){if(this.loading||!this.propertyId)return!1;let r;this.loading=!0;try{r=await t.propertyApi.getDetail({id:this.propertyId})}catch(c){return this.loading=!1,e.index$1.getStorageSync("token")||e.index$1.reLaunch({url:"/pages/login/login"}),!1}if(this.loading=!1,!r||0!==r.code)return setTimeout((()=>{e.index$1.navigateBack()}),600),!1;const o=r.data||{},i=o.property||{};if(!i||!i.id)return setTimeout((()=>{e.index$1.navigateBack()}),600),!1;this.property=i,this.isFollowed=!!o.is_followed,this.hasSmartLock=1===Number(i.has_smart_lock),this.ownerPhone=String(i.owner_phone||"").trim();const a=Array.isArray(o.images)?o.images:Array.isArray(i.images)?i.images:[];a.length>0&&(this.images=a),this.currentSwiper=0,this.attributes=this.buildAttributes(i);const n=o.renovation||{},s=String(n.renovation_status||"").trim();let p="none";"in_progress"===s||"done"===s||"none"===s?p=s:"1"===s?p="in_progress":"2"===s&&(p="done"),this.renovation={status:p,subtitle:String(n.subtitle||"房源装修情况").trim()||"房源装修情况",progress:Number(n.progress_percentage||0)||0,stage:String(n.current_stage||"").trim()||"—",eta:String(n.estimated_finish_date||"").trim()||"—",finishAt:String(n.actual_finish_date||"").trim()||"—",materials:Array.isArray(n.materials)?n.materials:[],note:String(n.notes||"").trim()||"—",images:Array.isArray(n.images)?n.images:[]};const l=Array.isArray(o.recommends)?o.recommends:[];return this.recommends=l.map((e=>({id:e.id,name:e.title||e.name||"房源",rooms:this.getLayoutText(e),price:`${e.price||"-"}${e.price_unit||""}`,size:e.area||"-",image:e.image||""}))),!0},onPageScroll(e){const t=Number(e&&e.detail&&e.detail.scrollTop||0),r=Math.min(1,t/160);this.headerOpacity=Math.max(0,Math.min(1,Number(r.toFixed(3))))},goBack(){e.index$1.navigateBack()},goToRec(t){const r=Number(t&&(t.id||t.ID))||0;r&&r!==this.propertyId&&e.index$1.redirectTo({url:`/pages/property_detail/property_detail?id=${encodeURIComponent(r)}`})},swiperChange(e){this.currentSwiper=e.detail.current},handleShare(){const t=this.property&&this.property.title?this.property.title:"房源",r=this.propertyId;e.index$1.showActionSheet({itemList:["生成获客海报","复制房源链接","模拟分享（占位）"],success:o=>{if(0!==o.tapIndex)if(1!==o.tapIndex)2===o.tapIndex&&e.index$1.showToast({title:"分享功能待接入",icon:"none"});else{const o=r?`/pages/property_detail/property_detail?id=${encodeURIComponent(r)}`:"/pages/property_detail/property_detail";e.index$1.setClipboardData({data:`${t}\n${o}`,success:()=>e.index$1.showToast({title:"已复制链接",icon:"none"})})}else e.index$1.navigateTo({url:`/pages/marketing_posters/marketing_posters?title=${encodeURIComponent(t)}`})}})},openMap(){const t=Number(this.property&&this.property.latitude),r=Number(this.property&&this.property.longitude),o=String(this.property&&(this.property.community_name||this.property.title)||"房源").trim(),i=String(this.property&&this.property.address||"").trim();t&&r&&isFinite(t)&&isFinite(r)?e.index$1.openLocation({latitude:t,longitude:r,name:o,address:i||o,fail:()=>{e.index$1.showToast({title:"无法打开地图",icon:"none"})}}):e.index$1.showToast({title:"暂无定位信息",icon:"none"})},async toggleFollow(){if(!this.propertyId)return;let r;try{r=await t.propertyApi.toggleFollow({id:this.propertyId})}catch(i){return void(e.index$1.getStorageSync("token")||e.index$1.reLaunch({url:"/pages/login/login"}))}if(!r||0!==r.code)return;const o=r.data||{};this.isFollowed=!!o.is_followed,this.property&&(this.property.follow_count=o.follow_count),e.index$1.showToast({title:this.isFollowed?"已关注":"已取消关注",icon:"none"})},callOwner(){this.ownerPhone?e.index$1.makePhoneCall({phoneNumber:this.ownerPhone}):e.index$1.showToast({title:"暂无业主电话",icon:"none"})},openLock(){const t=String(this.property&&this.property.sale_status||"").trim();if("sold"!==t&&"off_market"!==t)e.index$1.navigateTo({url:this.hasSmartLock?"/pages/unlock_steps/unlock_steps":"/pages/unlock_details/unlock_details"});else{const t=this.property&&this.property.sale_status_label?this.property.sale_status_label:"不可操作";e.index$1.showToast({title:`房源${t}，暂不可开锁`,icon:"none"})}},setRenovationStatus(e){}}};const i=e._export_sfc(o,[["render",function(t,o,i,a,n,s){return e.e({a:1-n.headerOpacity,b:n.headerOpacity,c:n.headerOpacity>.65?1:"",d:e.o(((...e)=>s.goBack&&s.goBack(...e))),e:n.headerTop+"px",f:e.f(n.images,((e,t,r)=>({a:e,b:t}))),g:e.o(((...e)=>s.swiperChange&&s.swiperChange(...e))),h:e.t(n.images.length?n.currentSwiper+1:0),i:e.t(n.images.length),j:e.t(n.property&&n.property.title||"-"),k:e.o(((...e)=>s.handleShare&&s.handleShare(...e))),l:e.f((n.property&&n.property.tags||[]).slice(0,6),((t,r,o)=>({a:e.t(t),b:r,c:e.n(s.tagClass(t))}))),m:e.t(n.property&&n.property.price||"-"),n:e.t(n.property&&n.property.price_unit||""),o:e.t(s.getLayoutText(n.property)),p:e.t(n.property&&n.property.area||"-"),q:e.t(s.getCommissionText(n.property)),r:e.t(n.property&&n.property.view_count||0),s:e.t(n.property&&n.property.follow_count||0),t:e.t(n.property&&n.property.showing_count||0),v:e.f(n.attributes,((t,r,o)=>({a:e.t(t.label),b:e.t(t.value),c:r}))),w:e.f(n.renovationTabs,((t,r,o)=>({a:e.t(t.label),b:t.key,c:n.renovation.status===t.key?1:"",d:e.o((e=>s.setRenovationStatus(t.key)),t.key)}))),x:e.t("none"===n.renovation.status?"未装修":"in_progress"===n.renovation.status?"装修进行中":"装修完成"),y:e.n(n.renovation.status),z:e.t(n.renovation.subtitle),A:"none"===n.renovation.status},"none"===n.renovation.status?{}:"in_progress"===n.renovation.status?{C:e.f(n.renovation.images,((e,t,r)=>({a:e,b:t}))),D:n.renovation.progress+"%",E:e.t(n.renovation.progress),F:e.t(n.renovation.stage),G:e.t(n.renovation.eta),H:e.f(n.renovation.materials,((t,r,o)=>({a:e.t(t),b:"m-"+r}))),I:e.t(n.renovation.note)}:{J:e.t(n.renovation.finishAt),K:e.f(n.renovation.materials,((t,r,o)=>({a:e.t(t),b:"dm-"+r}))),L:e.t(n.renovation.note)},{B:"in_progress"===n.renovation.status,M:e.o(((...e)=>s.openMap&&s.openMap(...e))),N:r._imports_0,O:e.t(s.mapPinText()),P:e.o(((...e)=>s.openMap&&s.openMap(...e))),Q:e.f(n.recommends,((t,r,o)=>({a:t.image,b:e.t(t.size),c:e.t(t.name),d:e.t(t.rooms),e:e.t(t.price),f:r,g:e.o((e=>s.goToRec(t)),r)}))),R:e.o(((...e)=>s.onPageScroll&&s.onPageScroll(...e))),S:e.o(((...e)=>s.callOwner&&s.callOwner(...e))),T:n.isFollowed},(n.isFollowed,{}),{U:e.o(((...e)=>s.toggleFollow&&s.toggleFollow(...e))),V:n.hasSmartLock},(n.hasSmartLock,{}),{W:e.t(n.hasSmartLock?"智能锁":"密码开锁"),X:e.o(((...e)=>s.openLock&&s.openLock(...e)))})}]]);o.__runtimeHooks=1,wx.createPage(i);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/property_detail/property_detail.js.map
