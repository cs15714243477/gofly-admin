"use strict";const e=require("../../common/vendor.js"),t=require("../../store/index.js"),n=require("../../api/user.js"),i={onLoad(){this.loadAgreementDocs()},data:()=>({mobile:"",captcha:"",submitting:!1,agreementDocs:{user_agreement:{title:"用户协议",content:"",url:""},privacy_policy:{title:"隐私政策",content:"",url:""},help_center:{title:"帮助中心",content:"",url:""}}}),methods:{goBack(){e.index$1.navigateBack()},goToRegister(){e.index$1.navigateTo({url:"/pages/registration/registration?mode=complete"})},async loadAgreementDocs(){try{const e=await n.userApi.getLoginDocs(!1);if(!e||0!==e.code||!e.data||!Array.isArray(e.data.docs))return;const t={...this.agreementDocs};e.data.docs.forEach((e=>{const n=String(e&&e.key?e.key:"").trim();if(!n||!t[n])return;const i=String(e&&e.title?e.title:"").trim(),o=String(e&&e.content?e.content:"").trim(),r=String(e&&e.url?e.url:"").trim();t[n]={title:i||t[n].title,content:o,url:r}})),this.agreementDocs=t}catch(e){}},hasAgreementDoc(e){const t=this.agreementDocs&&this.agreementDocs[e]?this.agreementDocs[e]:null;return!!t&&!(!String(t.content||"").trim()&&!String(t.url||"").trim())},openAgreement(t){const n=this.agreementDocs&&this.agreementDocs[t]?this.agreementDocs[t]:null,i=n&&n.title?String(n.title).trim():"文档",o=n&&n.content?String(n.content).trim():"",r=n&&n.url?String(n.url).trim():"";o||r?o||/^https?:\/\//i.test(r)?e.index$1.navigateTo({url:`/pages/doc_webview/doc_webview?key=${encodeURIComponent(t)}`}):e.index$1.navigateTo({url:r}):e.index$1.showToast({title:`${i}暂未配置`,icon:"none"})},async handleLogin(){if(this.mobile&&11===String(this.mobile).length)if(this.captcha){if(!this.submitting){this.submitting=!0;try{const e=await n.userApi.login({mobile:this.mobile,captcha:this.captcha});if(!e||0!==e.code)return;e.token&&t.$store("user").setToken(e.token),await t.$store("user").getInfo().catch((()=>{})),this.afterLoginSuccess()}finally{this.submitting=!1}}}else e.index$1.showToast({title:"请输入验证码",icon:"none"});else e.index$1.showToast({title:"请输入11位手机号",icon:"none"})},onGetPhoneNumber(i){const o=i&&i.detail&&i.detail.code;o?this.submitting||(this.submitting=!0,e.index$1.login({provider:"weixin",success:async e=>{try{const i=e&&e.code,r=await n.userApi.wxLogin({wx_code:i,phone_code:o});if(!r||0!==r.code)return;r.token&&t.$store("user").setToken(r.token),await t.$store("user").getInfo().catch((()=>{})),this.afterLoginSuccess()}finally{this.submitting=!1}},fail:()=>{this.submitting=!1,e.index$1.showToast({title:"获取微信登录凭证失败",icon:"none"})}})):e.index$1.showToast({title:"未授权手机号",icon:"none"})},afterLoginSuccess(){e.index$1.reLaunch({url:"/pages/property_list/property_list"})}}};const o=e._export_sfc(i,[["render",function(t,n,i,o,r,s){return{a:e.o(((...e)=>s.onGetPhoneNumber&&s.onGetPhoneNumber(...e))),b:e.t(r.agreementDocs.user_agreement.title),c:s.hasAgreementDoc("user_agreement")?"":1,d:e.o((e=>s.openAgreement("user_agreement"))),e:e.t(r.agreementDocs.privacy_policy.title),f:s.hasAgreementDoc("privacy_policy")?"":1,g:e.o((e=>s.openAgreement("privacy_policy"))),h:e.t(r.agreementDocs.help_center.title),i:s.hasAgreementDoc("help_center")?"":1,j:e.o((e=>s.openAgreement("help_center")))}}]]);wx.createPage(o);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/login/login.js.map
