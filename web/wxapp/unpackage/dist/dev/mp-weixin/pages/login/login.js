"use strict";const e=require("../../common/vendor.js"),t=require("../../store/index.js"),o=require("../../api/user.js"),i={data:()=>({showMoreLogin:!1,mobile:"",captcha:"",submitting:!1}),methods:{goBack(){e.index$1.navigateBack()},goToRegister(){e.index$1.navigateTo({url:"/pages/registration/registration?mode=complete"})},async handleLogin(){if(this.mobile&&11===String(this.mobile).length)if(this.captcha){if(!this.submitting){this.submitting=!0;try{const e=await o.userApi.login({mobile:this.mobile,captcha:this.captcha});if(!e||0!==e.code)return;e.token&&t.$store("user").setToken(e.token),await t.$store("user").getInfo().catch((()=>{})),this.afterLoginSuccess()}finally{this.submitting=!1}}}else e.index$1.showToast({title:"请输入验证码",icon:"none"});else e.index$1.showToast({title:"请输入11位手机号",icon:"none"})},toggleMoreLogin(){this.showMoreLogin=!this.showMoreLogin},onGetPhoneNumber(i){const n=i&&i.detail&&i.detail.code;n?this.submitting||(this.submitting=!0,e.index$1.login({provider:"weixin",success:async e=>{try{const i=e&&e.code,s=await o.userApi.wxLogin({wx_code:i,phone_code:n});if(!s||0!==s.code)return;s.token&&t.$store("user").setToken(s.token),await t.$store("user").getInfo().catch((()=>{})),this.afterLoginSuccess()}finally{this.submitting=!1}},fail:()=>{this.submitting=!1,e.index$1.showToast({title:"获取微信登录凭证失败",icon:"none"})}})):e.index$1.showToast({title:"未授权手机号",icon:"none"})},afterLoginSuccess(){e.index$1.reLaunch({url:"/pages/property_list/property_list"})}}};const n=e._export_sfc(i,[["render",function(t,o,i,n,s,r){return e.e({a:e.o(((...e)=>r.onGetPhoneNumber&&r.onGetPhoneNumber(...e))),b:e.t(s.showMoreLogin?"收起其他登录方式":"更多登录方式"),c:e.t(s.showMoreLogin?"expand_less":"expand_more"),d:e.o(((...e)=>r.toggleMoreLogin&&r.toggleMoreLogin(...e))),e:s.showMoreLogin},s.showMoreLogin?{f:s.mobile,g:e.o((e=>s.mobile=e.detail.value)),h:s.captcha,i:e.o((e=>s.captcha=e.detail.value)),j:e.t(s.submitting?"登录中...":"登录"),k:s.submitting,l:e.o(((...e)=>r.handleLogin&&r.handleLogin(...e))),m:e.o(((...e)=>r.goToRegister&&r.goToRegister(...e)))}:{})}]]);wx.createPage(n);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/login/login.js.map
