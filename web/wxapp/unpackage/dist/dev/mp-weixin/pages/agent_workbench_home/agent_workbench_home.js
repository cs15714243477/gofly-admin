"use strict";const e=require("../../common/vendor.js"),o=require("../../store/index.js"),n={components:{BottomTabBar:()=>"../../components/BottomTabBar.js",TopHeader:()=>"../../components/TopHeader.js"},data:()=>({loadingUser:!1,debugLogged:!1,userInfo:{},businessRecords:[{key:"property_manage",name:"房源管理",icon:"home_work"},{key:"lock_manage",name:"智能门锁",icon:"smart_lock"},{key:"follow",name:"关注记录",icon:"favorite"},{key:"unlock",name:"开锁记录",icon:"lock_open",hasNotice:!0},{key:"showing",name:"带看记录",icon:"location_on"},{key:"view",name:"浏览记录",icon:"history"},{key:"share",name:"分享记录",icon:"share"},{key:"call",name:"通话记录",icon:"call"}]}),computed:{avatarUrl(){return this.userInfo&&this.userInfo.avatar?this.userInfo.avatar:"/static/images/img_83575f387f.png"},displayName(){const e=this.userInfo||{};return e.name||e.nickname||e.username||"未登录"},displayRoleLine(){const e=this.userInfo||{},o=(e.title||"").trim(),n=String(e.role||"").trim(),r=(e.store_name||"").trim(),s=r||"未绑定";let a=o;return a||(a=""===n||"1"===n||"user"===n.toLowerCase()?"经纪人":n),`${a} | ${s}`},displayMobile(){return(this.userInfo||{}).mobile||""},displayRecords(){const e=this.userInfo||{},o=1===Number(e.can_manage_properties),n=1===Number(e.can_manage_locks);return(this.businessRecords||[]).filter((e=>!!e&&("property_manage"===e.key?o:"lock_manage"!==e.key||n)))}},onShow(){this.ensureLoginAndLoadUser()},methods:{debugPrintUserInfo(o=""){var n,r,s,a;if(!this.debugLogged){this.debugLogged=!0;try{e.index$1.__f__("log","at pages/agent_workbench_home/agent_workbench_home.vue:159","[agent_workbench_home] "+(o||"userInfo")+" store_name=",null==(n=this.userInfo)?void 0:n.store_name,"store_id=",null==(r=this.userInfo)?void 0:r.store_id,"title=",null==(s=this.userInfo)?void 0:s.title,"role=",null==(a=this.userInfo)?void 0:a.role),e.index$1.__f__("log","at pages/agent_workbench_home/agent_workbench_home.vue:160","[agent_workbench_home] "+(o||"userInfo")+" full=",JSON.parse(JSON.stringify(this.userInfo||{})))}catch(t){e.index$1.__f__("log","at pages/agent_workbench_home/agent_workbench_home.vue:162","[agent_workbench_home] debugPrintUserInfo error",t)}}},debugShowUserInfo(){try{const o=this.userInfo||{},n=[`name: ${o.name||""}`,`nickname: ${o.nickname||""}`,`username: ${o.username||""}`,`title: ${o.title||""}`,`role: ${o.role||""}`,`store_name: ${o.store_name||""}`,`store_id: ${o.store_id||""}`,`store_address: ${o.store_address||""}`];e.index$1.showModal({title:"调试：userInfo(点击头像)",content:n.join("\n"),showCancel:!1})}catch(o){e.index$1.showToast({title:"调试弹窗失败",icon:"none"})}},async ensureLoginAndLoadUser(){const n=o.$store("user"),r=e.index$1.getStorageSync("token");if(r&&!n.isLogin&&n.setToken(r),r||n.isLogin){if(!this.loadingUser){this.loadingUser=!0;try{const e=await n.getInfo();this.userInfo=e||n.userInfo||{},this.debugPrintUserInfo("after getInfo")}catch(s){this.userInfo=n.userInfo||{},this.debugPrintUserInfo("fallback userStore.userInfo")}finally{this.loadingUser=!1}}}else e.index$1.reLaunch({url:"/pages/login/login"})},goEditCard(){e.index$1.reLaunch({url:"/pages/my_business_card/my_business_card?tab=1"})},openRecord(o){const n=o&&o.key&&{property_manage:"/pages/property_manage/property_manage",lock_manage:"/pages/lock_manage/lock_manage",follow:"/pages/records/record_follow",unlock:"/pages/records/record_unlock",showing:"/pages/records/record_showing",view:"/pages/records/record_view",share:"/pages/records/record_share",call:"/pages/records/record_call"}[o.key];n&&e.index$1.navigateTo({url:n})},handleLogout(){e.index$1.showModal({title:"提示",content:"确定要退出登录吗？",success:async n=>{if(n.confirm){try{await o.$store("user").logout(!1)}catch(r){}e.index$1.reLaunch({url:"/pages/login/login"})}}})}}};if(!Array){(e.resolveComponent("TopHeader")+e.resolveComponent("BottomTabBar"))()}const r=e._export_sfc(n,[["render",function(o,n,r,s,a,t){return{a:e.p({title:"我的"}),b:e.o(((...e)=>t.goEditCard&&t.goEditCard(...e))),c:t.avatarUrl,d:e.t(t.displayName),e:e.t(t.displayRoleLine),f:e.t(t.displayMobile),g:e.f(t.displayRecords,((o,n,r)=>e.e({a:e.t(o.icon),b:"lock_manage"===o.key?1:"",c:o.hasNotice},(o.hasNotice,{}),{d:e.t(o.name),e:n,f:e.o((e=>t.openRecord(o)),n)}))),h:e.o(((...e)=>t.handleLogout&&t.handleLogout(...e))),i:e.p({active:"me"})}}]]);wx.createPage(r);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/agent_workbench_home/agent_workbench_home.js.map
