"use strict";const t=require("../../common/vendor.js"),e=require("../../api/property.js"),s=require("../../api/ttlock.js"),r={data:()=>({statusBarHeight:0,headerTop:0,propertyId:0,coverImage:"",passcode:"",startDate:0,endDate:0,remainSeconds:0,timer:null}),computed:{passcodeDisplay(){const t=String(this.passcode||"").trim();if(!t)return"——";const e=t.replace(/\s+/g,"");return/^\d{6}$/.test(e)?`${e.slice(0,3)} ${e.slice(3)}`:t},remainLabel(){if(!this.endDate)return"—";const t=Number(this.remainSeconds||0);if(!Number.isFinite(t)||t<=0)return"已过期";return`${Math.floor(t/3600)}小时${Math.floor(t%3600/60)}分${Math.floor(t%60)}秒`}},onLoad(e){const s=Number(e&&(e.property_id||e.id)||0);this.propertyId=Number.isFinite(s)?s:0;const r=t.index$1.getSystemInfoSync();this.statusBarHeight=r.statusBarHeight;try{if(void 0!==t.wx$1&&t.wx$1.getMenuButtonBoundingClientRect){const e=t.wx$1.getMenuButtonBoundingClientRect();this.headerTop=Number(e.top||this.statusBarHeight)+6}else this.headerTop=this.statusBarHeight+12}catch(a){this.headerTop=this.statusBarHeight+12}this.loadPasscode(),this.loadPropertyCover()},onUnload(){this.clearTimer()},methods:{normalizeImage(t){const e=String(t||"").trim();return e?0===e.indexOf("/static/images/")?"":e:""},async loadPropertyCover(){if(this.propertyId)try{const t=await e.propertyApi.getDetail({id:this.propertyId,public:0});if(!t||0!==t.code)return;const s=t.data||{},r=s.property||{},a=this.normalizeImage(r.cover_image),i=String(r.video_url||"").trim(),o=(Array.isArray(s.images)?s.images:Array.isArray(r.images)?r.images:[]).map((t=>this.normalizeImage(t))).filter(Boolean),n=[];i&&a&&n.push(a),o.length&&n.push(o[0]),!n.length&&a&&n.push(a),this.coverImage=n[0]||""}catch(t){}},goBack(){t.index$1.navigateBack()},clearTimer(){this.timer&&(clearInterval(this.timer),this.timer=null)},startTimer(){this.clearTimer(),this.timer=setInterval((()=>{if(!this.endDate)return;const t=Math.floor((this.endDate-Date.now())/1e3);this.remainSeconds=t>0?t:0}),1e3)},formatTime(t){const e=Number(t||0);if(!e)return"--:--";const s=new Date(e);return`${String(s.getHours()).padStart(2,"0")}:${String(s.getMinutes()).padStart(2,"0")}`},async loadPasscode(){if(!this.propertyId)return void t.index$1.showToast({title:"缺少房源ID，无法获取密码",icon:"none"});const e=await s.ttlockApi.getPropertyPasscode({property_id:this.propertyId});if(!e||0!==e.code)return;const r=e.data||{};this.passcode=String(r.keyboardPwd||r.keyboard_pwd||"").trim(),this.startDate=Number(r.startDate||r.start_date||0)||0,this.endDate=Number(r.endDate||r.end_date||0)||0,this.remainSeconds=this.endDate?Math.max(0,Math.floor((this.endDate-Date.now())/1e3)):0,this.startTimer()},async refreshPasscode(){const e=String(this.passcode||"").trim();await this.loadPasscode();const s=String(this.passcode||"").trim();s&&s!==e?t.index$1.showToast({title:"已更换新密码",icon:"success"}):s&&t.index$1.showToast({title:"密码已刷新",icon:"none"})},extendPasscode(){t.index$1.showToast({title:"暂不支持延时，可点击“换新密码”重新生成",icon:"none"})},copyPassword(){const e=String(this.passcode||"").trim().replace(/\s+/g,"");e?t.index$1.setClipboardData({data:e,success:()=>{t.index$1.showToast({title:"复制成功",icon:"success"})}}):t.index$1.showToast({title:"暂无可复制的密码",icon:"none"})}}};const a=t._export_sfc(r,[["render",function(e,s,r,a,i,o){return t.e({a:t.o(((...t)=>o.goBack&&o.goBack(...t))),b:i.headerTop+"px",c:i.coverImage},i.coverImage?{d:i.coverImage}:{},{e:t.t(i.propertyId),f:t.t(o.passcodeDisplay),g:t.o(((...t)=>o.copyPassword&&o.copyPassword(...t))),h:t.t(o.remainLabel),i:t.o(((...t)=>o.extendPasscode&&o.extendPasscode(...t))),j:t.t(o.formatTime(i.startDate)),k:t.t(o.formatTime(i.endDate)),l:t.o(((...t)=>o.refreshPasscode&&o.refreshPasscode(...t)))})}]]);wx.createPage(a);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/unlock_details/unlock_details.js.map
